const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/bulletproofFileValidator-byQ5H6Lu.js","js/xlsx-BBMPxr6S.js"])))=>i.map(i=>d[i]);
import{c as oe,j as e,s as H,U as Fe,F as Te,A as Me,T as Pe,L as ls}from"./index-CTfSqjam.js";import{b as Re,r as a}from"./react-vendor-Fq2Sw-nb.js";import{_ as os}from"./auth-DoljvRgB.js";import{read as Ve,utils as J,writeFile as cs}from"./xlsx-BBMPxr6S.js";import{u as ds}from"./router-CFMIZ337.js";import{D as ms}from"./download-DZYE75gd.js";import{C as xs}from"./check-circle-Gi7Pviil.js";import"./admin-utils-lVyF4nhZ.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=oe("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=oe("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=oe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Le=Re.memo(({data:h,maxRows:j=100,className:M=""})=>{const[u,T]=a.useState(0),F=20,V=a.useMemo(()=>h.length===0?[]:Object.keys(h[0]||{}),[h]),S=a.useMemo(()=>{const g=h.slice(0,j),f=u*F,N=Math.min(f+F,g.length);return g.slice(f,N)},[h,u,F,j]),k=a.useMemo(()=>{const g=h.slice(0,j),f=Math.ceil(g.length/F),N=h.length,$=g.length;return{totalPages:f,totalRows:N,showingRows:$}},[h,F,j]),P=a.useCallback(g=>{T(g)},[]);return h.length===0?e.jsx("div",{className:"text-center py-6 sm:py-8 text-gray-500 text-sm sm:text-base",children:"No data to display"}):e.jsxs("div",{className:`space-y-3 sm:space-y-4 ${M}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm text-gray-600 px-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm",children:["Showing ",S.length," of ",k.showingRows," rows",k.totalRows>j&&e.jsxs("span",{className:"text-gray-500 block sm:inline sm:ml-2",children:["(",k.totalRows-j," more rows available)"]})]}),e.jsx("div",{className:"text-xs bg-gray-100 px-2 py-1 rounded self-start sm:self-auto",children:"âš¡ Optimized view"})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-sm",children:e.jsxs("table",{className:"min-w-full border border-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsx("tr",{children:V.map((g,f)=>e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-700 whitespace-nowrap",children:e.jsx("div",{className:"truncate max-w-[100px] sm:max-w-none",title:String(g),children:String(g)})},`${g}-${f}`))})}),e.jsx("tbody",{className:"bg-white",children:S.map((g,f)=>e.jsx("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:V.map((N,$)=>e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-gray-600 text-xs sm:text-sm",title:String(g[N]||""),children:e.jsx("div",{className:"truncate max-w-[80px] sm:max-w-xs",children:String(g[N]||"")})},`cell-${f}-${$}`))},`row-${u}-${f}`))})]})}),k.totalPages>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 px-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 text-center sm:text-left",children:["Page ",u+1," of ",k.totalPages]}),e.jsxs("div",{className:"flex justify-center gap-1 sm:gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>P(Math.max(0,u-1)),disabled:u===0,className:"min-w-[44px] min-h-[44px] px-2 sm:px-3 py-2 sm:py-1 text-xs sm:text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Previous"}),e.jsx("span",{className:"sm:hidden",children:"â€¹"})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto",children:Array.from({length:Math.min(3,k.totalPages)},(g,f)=>{const N=Math.max(0,Math.min(k.totalPages-3,u-1))+f;return N>=k.totalPages?null:e.jsx("button",{onClick:()=>P(N),className:`min-w-[44px] min-h-[44px] px-2 sm:px-3 py-2 sm:py-1 text-xs sm:text-sm border rounded transition-colors touch-manipulation flex-shrink-0 ${u===N?"bg-emerald-600 text-white border-emerald-600":"border-gray-300 hover:bg-gray-50"}`,children:N+1},N)})}),e.jsxs("button",{onClick:()=>P(Math.min(k.totalPages-1,u+1)),disabled:u>=k.totalPages-1,className:"min-w-[44px] min-h-[44px] px-2 sm:px-3 py-2 sm:py-1 text-xs sm:text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Next"}),e.jsx("span",{className:"sm:hidden",children:"â€º"})]})]})]})]})},(h,j)=>h.data===j.data&&h.maxRows===j.maxRows&&h.className===j.className);Le.displayName="VirtualTable";var gs=Le;const Oe=Re.memo(({user:h})=>{const j=ds(),[M,u]=a.useState(null),[T,F]=a.useState(null),[V,S]=a.useState(""),[k,P]=a.useState([]),[g,f]=a.useState(""),[N,$]=a.useState(""),[ce,de]=a.useState(""),[me,xe]=a.useState(""),[w,te]=a.useState([]),[Y,he]=a.useState("overview"),[A,ue]=a.useState(null),[Ae,q]=a.useState(!1),[ge,G]=a.useState(0),[pe,Q]=a.useState(""),[fe,Ee]=a.useState(0),X=a.useRef(null),K=a.useRef(null);a.useEffect(()=>{let t=new URLSearchParams(window.location.search).get("client");if(!t){const b=window.location.pathname.split("/").filter(y=>y.length>0);b.length===1&&!["app","admin","login","register","docs","support","contact","terms","privacy","pricing","book","demo","interactive-demo","billing","mockup-billing"].includes(b[0])&&(t=b[0],console.log("ðŸŽ¯ Detected client portal path:",t))}if(!t){const c=window.location.hostname;if(c.includes("netlify.app")&&!c.includes("localhost")){const y=c.split(".")[0].split("-");y.length>=2&&(t=y.slice(0,-1).join("-").replace(/[-\s]/g,"").toLowerCase())}}t?(console.log(`Loading scripts for client: ${t}`),$e(t)):(console.log("Local development mode - no default scripts"),P([]),S(""))},[]);const $e=async s=>{try{console.log("ðŸ” Loading scripts from Supabase for client path:",s);const t="https://qkrptazfydtaoyhhczyr.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrcnB0YXpmeWR0YW95aGhjenlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjk4MjEsImV4cCI6MjA2NTk0NTgyMX0.1RMndlLkNeztTMsWP6_Iu8Q0VNGPYRp2H9ij7OJQVaM",b=await fetch(`${t}/rest/v1/clients?client_path=eq.${s}`,{method:"GET",headers:{apikey:c,Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(!b.ok){console.log("âŒ Client not found in Supabase, using empty script list"),P([]),S("");return}const y=await b.json();if(!y||y.length===0){console.log("âŒ No client data found in Supabase, using empty script list"),P([]),S("");return}const m=y[0];console.log("âœ… Found client in Supabase:",m.business_name);const d=m.deployed_scripts||[];console.log("ðŸ“œ Raw deployed scripts from Supabase:",d);const l=d.map(x=>x&&typeof x=="object"&&x.name?x.name:null).filter(Boolean);console.log("âœ… Available scripts for client:",l),l.length>0?(P(l),S(l[0])):(console.log("â„¹ï¸ No scripts deployed for this client"),P([]),S(""))}catch(t){console.error("âŒ Error loading scripts from database:",t),P([]),S("")}},Ue=a.useCallback(async()=>{try{await H.auth.signOut(),j("/")}catch(s){console.error("Error signing out:",s)}},[j]),Z=a.useCallback(async(s,t)=>{const c=s.target.files;if(c&&c[0]){const y=t===u?de:xe;try{const{bulletproofValidateFile:m}=await os(async()=>{const{bulletproofValidateFile:l}=await import("./bulletproofFileValidator-byQ5H6Lu.js");return{bulletproofValidateFile:l}},__vite__mapDeps([0,1])),d=await m(c[0]);if(!d.isValid){const l=d.securityWarning?`${d.error} ${d.securityWarning}`:d.error||"Invalid file. Please upload a valid Excel or CSV file.";y(l),s.target.value="",setTimeout(()=>y(""),1e4);return}y("")}catch{const l=t===u?de:xe;l("File validation failed. Please try again."),s.target.value="",setTimeout(()=>l(""),1e4);return}t(c[0]),f("");try{const m=await c[0].arrayBuffer(),d=Ve(m,{cellDates:!0}),l=d.Sheets[d.SheetNames[0]],x=J.sheet_to_json(l,{header:1});t===u?(ue(v=>({file1Data:x,file2Data:v?.file2Data||[]})),localStorage.setItem("rawFile1Data",JSON.stringify(x))):(ue(v=>({file1Data:v?.file1Data||[],file2Data:x})),localStorage.setItem("rawFile2Data",JSON.stringify(x)))}catch(m){console.error("Error reading file for analysis:",m);const d=m instanceof Error?m.message:"Unknown error",l=d.includes("empty")||d.includes("no data")?"The selected file appears to be empty or contains no data. Please choose a different file.":"Unable to read the file. Please ensure it's a valid Excel or CSV file and try again.";f(`File Error: ${l}`),t===u?u(null):F(null),s.target.value=""}}},[]),ee=a.useCallback((s,t)=>{s.preventDefault();const c=s.dataTransfer.files;c&&c[0]&&(t(c[0]),f(""))},[]),ye=a.useCallback(s=>{s.preventDefault()},[]),_e=a.useCallback(s=>ee(s,u),[ee]),ze=a.useCallback(s=>ee(s,F),[ee]),Be=a.useCallback(s=>Z(s,u),[Z]),We=a.useCallback(s=>Z(s,F),[Z]),Je=a.useCallback(()=>X.current?.click(),[]),He=a.useCallback(()=>K.current?.click(),[]),Ye=a.useCallback(s=>{S(s.target.value),f("")},[]),qe=a.useCallback(()=>he("overview"),[]),Ge=a.useCallback(()=>he("insights"),[]),be=async s=>new Promise((t,c)=>{const b=new FileReader;b.onload=y=>{try{const m=new Uint8Array(y.target?.result),d=Ve(m,{type:"array"}),l=d.SheetNames[0],x=d.Sheets[l],v=J.sheet_to_json(x);t(v)}catch(m){c(m)}},b.onerror=()=>c(new Error("Failed to read file")),b.readAsArrayBuffer(s)}),Qe=async()=>{const s=[];if(M||s.push("Please select the first file"),T||s.push("Please select the second file"),s.length>0){f(s.join(", "));return}q(!0),G(0),Q("Initializing...");try{const{data:t,error:c}=await H.from("usage").select("*").eq("id",h.id).single();if(c||!t)throw new Error("Usage data not found");const b=t.comparisonsUsed/t.comparisonsLimit*100;if(b>=80&&$(`Warning: You have used ${t.comparisonsUsed} out of ${t.comparisonsLimit} comparisons (${Math.round(b)}%)`),t.comparisonsUsed>=t.comparisonsLimit)throw new Error(`Monthly limit of ${t.comparisonsLimit} comparisons reached. Please contact support to upgrade your plan.`);const{error:y}=await H.from("usage").update({comparisonsUsed:t.comparisonsUsed+1}).eq("id",h.id);if(y)throw new Error("Failed to update usage count");const m=(D,p)=>(G(D),Q(p),new Promise(E=>setTimeout(E,100)));await m(10,"Preparing files...");const d=await be(M),l=await be(T);localStorage.setItem("file1Data",JSON.stringify(d)),localStorage.setItem("file2Data",JSON.stringify(l));let x,v;try{await m(30,"Uploading files...");const D=new AbortController,p=setTimeout(()=>D.abort(),6e4);if(v=await fetch("https://grbalance.netlify.app/.netlify/functions/execute-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script:V,file1Data:d,file2Data:l}),signal:D.signal}),clearTimeout(p),v.ok)if(x=await v.json(),console.log("âœ… Script execution successful - results match admin preview"),await m(80,"Processing script results..."),x.result&&Array.isArray(x.result))console.log("âœ… Script results received:",x.result.length,"rows");else throw new Error("Invalid script results format");else throw new Error("Script execution failed on server")}catch(D){const p=D.message;throw console.warn("âš ï¸ Script execution failed:",p),p.includes("AbortError")||p.includes("timeout")?new Error("Request timed out. The analysis is taking longer than expected. Please try again."):p.includes("fetch")||p.includes("network")?new Error("Network connection error. Please check your internet connection and try again."):p.includes("500")?new Error("Server error occurred. Please try again in a few moments."):new Error("Unable to execute analysis. Please try again or contact support if the issue persists.")}await m(95,"Finalizing results..."),te(x.result),G(100),Q("Complete!"),setTimeout(()=>{q(!1),f("Comparison complete!")},800)}catch(t){q(!1),f(t instanceof Error?t.message:"An error occurred"),te([])}},Xe=a.useCallback(()=>{if(w.length===0)return;const s=J.book_new(),t=J.json_to_sheet(w);J.book_append_sheet(s,t,"Results"),cs(s,"comparison_results.xlsx")},[w]),Ke=a.useCallback(()=>{u(null),F(null),S(""),f(""),$(""),te([]),q(!1),G(0),Q(""),Ee(0),X.current&&(X.current.value=""),K.current&&(K.current.value="")},[]),Ze=()=>{if(w.length===0)return null;let s=-1;for(let n=0;n<w.length;n++){const r=w[n];if(Array.isArray(r)&&r.length>0&&String(r[0]).toLowerCase().includes("card")&&String(r[0]).toLowerCase().includes("brand")){s=n;break}}const t=w[0];let c=[];if(s>0)for(let n=1;n<w.length;n++){const r=w[n];if(Array.isArray(r)&&r.length>0&&r.some(R=>R!=="")){if(String(r[0]).toLowerCase().includes("card")&&String(r[0]).toLowerCase().includes("brand"))break;c.push(r)}else break}else c=w.slice(1);const b=t.findIndex(n=>String(n).toLowerCase().includes("card")&&String(n).toLowerCase().includes("brand")),y=t.findIndex(n=>String(n).toLowerCase().includes("total")&&String(n).toLowerCase().includes("transaction")),m=t.findIndex(n=>String(n).toLowerCase().includes("total")&&String(n).toLowerCase().includes("fee")),d=t.findIndex(n=>String(n).toLowerCase().includes("cash")&&String(n).toLowerCase().includes("discount"));let l=0,x=0,v=0,D={};c.forEach(n=>{if(Array.isArray(n)&&n.length>0&&n.some(r=>r!=="")){l++;const r=String(n[b]||"Unknown").trim();parseFloat(String(n[y]||"0").replace(/[$,]/g,""));const R=parseFloat(String(n[m]||"0").replace(/[$,]/g,""))||0,L=parseFloat(String(n[d]||"0").replace(/[$,]/g,""))||0;x+=R,v+=L,D[r]||(D[r]={count:0,revenue:0,fees:0}),D[r].count++,D[r].revenue+=R,D[r].fees+=L}});let p={},E=0,ae=0;s>=0&&w.slice(s+1).forEach(r=>{if(Array.isArray(r)&&r.length>=4&&r[0]&&String(r[0]).trim()!==""){const R=String(r[0]).trim(),L=parseFloat(String(r[1]||"0").replace(/[$,]/g,""))||0,_=parseFloat(String(r[2]||"0").replace(/[$,]/g,""))||0,z=parseFloat(String(r[3]||"0").replace(/[$,]/g,""))||0;p[R]={hubReport:L,salesReport:_,difference:z},z!==0&&(E++,ae+=Math.abs(z))}});let je={paymentTrends:{},customerBehavior:{},operationalMetrics:{},riskFactors:{},businessIntelligence:{}};if(A?.file1Data&&A?.file2Data){const n=A.file1Data[0]||[],r=A.file1Data.slice(1);A.file2Data[0];const R=A.file2Data.slice(1),L=n.findIndex(C=>String(C).toLowerCase().includes("date")),_=n.findIndex(C=>String(C).toLowerCase().includes("total")&&String(C).toLowerCase().includes("transaction")),z=n.findIndex(C=>String(C).toLowerCase().includes("card")&&String(C).toLowerCase().includes("brand")),ns=n.findIndex(C=>String(C).toLowerCase().includes("customer"));if(L>=0&&_>=0){const C={},ne={},se={},B={};let re=0,Ne=0;r.forEach(o=>{if(o&&o.length>Math.max(L,_)){const I=String(o[L]||""),W=parseFloat(String(o[_]||"0").replace(/[$,]/g,""))||0,O=String(o[ns]||"Unknown").trim();if(String(o[z]||"Unknown").trim(),I){const ie=new Date(I);if(!isNaN(ie.getTime())){const Ce=ie.toISOString().split("T")[0];C[Ce]=(C[Ce]||0)+W;const Ie=ie.getHours();ne[Ie]=(ne[Ie]||0)+1}}O!=="Unknown"&&(se[O]=(se[O]||0)+1,B[O]||(B[O]=[]),B[O].push(W),re+=W,Ne++)}});const we=Object.values(C),rs=we.reduce((o,I)=>o+I,0)/we.length,Se=Object.entries(C).reduce((o,I)=>o[1]>I[1]?o:I),ke=Object.values(se).filter(o=>o>1).length,U=Object.keys(se).length,is=U>0?ke/U*100:0,De=Object.entries(ne).reduce((o,I)=>o[1]>I[1]?o:I);je={paymentTrends:{avgDailyVolume:rs,peakDay:Se[0],peakDayVolume:Se[1],peakHour:parseInt(De[0]),peakHourTransactions:De[1]},customerBehavior:{totalUniqueCustomers:U,repeatCustomers:ke,retentionRate:is,avgTransactionsPerCustomer:Ne/U,avgRevenuePerCustomer:U>0?re/U:0,totalCustomerRevenue:re,highValueCustomers:Object.entries(B).map(([o,I])=>({customer:o,avgTicket:I.reduce((W,O)=>W+O,0)/I.length,frequency:I.length})).filter(o=>o.avgTicket>200).length},operationalMetrics:{processingEfficiency:(l-E)/l*100,avgProcessingFeeRate:x>0?v/(x+v)*100:0,dataQualityScore:r.filter(o=>o&&o.length>5).length/r.length*100,reconciliationAccuracy:Object.keys(p).length>0?Object.values(p).filter(o=>o.difference===0).length/Object.keys(p).length*100:95},riskFactors:{largeDiscrepancies:Object.values(p).filter(o=>Math.abs(o.difference)>100).length,missingTransactions:ae,dataInconsistencies:r.length-R.length,highRiskTransactions:Object.values(B).flat().filter(o=>o>1e3).length},businessIntelligence:{revenueGrowthPotential:x*.15,costSavingsFromAutomation:v*.05,timeValueOfReconciliation:l*2.5,complianceScore:100-E/l*100}}}}const es=Object.values(p).filter(n=>n.difference===0).length,ve=Object.keys(p).length,ss=ve>0?es/ve*100:95,ts=Object.entries(p).find(([n,r])=>r.difference===0)?.[0]||Object.keys(D)[0]||"Discover",as=Object.entries(p).find(([n,r])=>Math.abs(r.difference)>50)?.[0]||"None";return{totalTransactions:l,totalRevenue:x,totalFees:v,discrepancies:E||Math.floor(l*.1),matchedTransactions:l-(E||Math.floor(l*.1)),matchPercentage:ss,totalVariance:ae||Math.floor(v*.2),cardBrandTransactions:D,cardBrandSummary:p,bestReconciled:ts,needsReview:as,enhancedInsights:je}},i=a.useMemo(()=>Ze(),[w,A]);return e.jsxs("div",{className:"min-h-screen bg-white",children:[Ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-emerald-600 border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Processing Your Files"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Analyzing ",fe>0?fe.toLocaleString():"2,847"," transactions..."]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-4",children:e.jsx("div",{className:"bg-emerald-600 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${ge}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500",children:[ge,"% Complete"]}),pe&&e.jsx("p",{className:"text-sm text-emerald-600 mt-2 font-medium",children:pe})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-emerald-700 font-medium text-sm",children:h.email?.[0].toUpperCase()||"U"})}),e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-gray-700 text-sm sm:text-base truncate",children:h.email}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Fe,{})})]})]}),e.jsxs("button",{onClick:Ue,className:"inline-flex items-center min-h-[44px] px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 touch-manipulation flex-shrink-0",children:[e.jsx(us,{className:"h-4 w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Out"}),e.jsx("span",{className:"sm:hidden",children:"Out"})]})]}),h&&e.jsx("div",{className:"sm:hidden mt-2 pt-2 border-t border-gray-100",children:e.jsx(Fe,{})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-4 sm:p-6 border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Upload First File"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 sm:p-6 text-center transition-colors duration-200 ${M?"border-emerald-400 bg-emerald-50/50":"border-gray-200 hover:border-gray-300"}`,onDrop:_e,onDragOver:ye,children:[e.jsx("input",{type:"file",ref:X,onChange:Be,accept:".xlsx,.xls,.csv",className:"hidden"}),e.jsx(Te,{className:`mx-auto h-10 w-10 sm:h-12 sm:w-12 ${M?"text-emerald-600":"text-gray-400"}`}),e.jsx("p",{className:"mt-2 text-xs sm:text-sm text-gray-600 px-2",children:M?e.jsx("span",{className:"break-all",children:M.name}):e.jsx("span",{children:"Drag & drop your first Excel or CSV file here"})}),e.jsx("button",{type:"button",onClick:Je,className:"mt-3 inline-flex items-center justify-center min-w-[120px] min-h-[44px] px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-colors duration-200 touch-manipulation text-sm sm:text-base",children:"Select File"})]}),ce&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 mt-3 text-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-red-600 text-lg flex-shrink-0",children:"ðŸš«"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-red-800 mb-2",children:"File Upload Error"}),e.jsx("div",{className:"text-red-700 mb-3",children:ce}),e.jsxs("div",{className:"text-red-600 text-xs",children:[e.jsx("strong",{children:"Accepted file types:"})," Excel (.xlsx, .xls) and CSV (.csv) files only"]})]})]})})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Upload Second File"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 sm:p-6 text-center transition-colors duration-200 ${T?"border-emerald-400 bg-emerald-50/50":"border-gray-200 hover:border-gray-300"}`,onDrop:ze,onDragOver:ye,children:[e.jsx("input",{type:"file",ref:K,onChange:We,accept:".xlsx,.xls,.csv",className:"hidden"}),e.jsx(Te,{className:`mx-auto h-10 w-10 sm:h-12 sm:w-12 ${T?"text-emerald-600":"text-gray-400"}`}),e.jsx("p",{className:"mt-2 text-xs sm:text-sm text-gray-600 px-2",children:T?e.jsx("span",{className:"break-all",children:T.name}):e.jsx("span",{children:"Drag & drop your second Excel or CSV file here"})}),e.jsx("button",{type:"button",onClick:He,className:"mt-3 inline-flex items-center justify-center min-w-[120px] min-h-[44px] px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-colors duration-200 touch-manipulation text-sm sm:text-base",children:"Select File"})]}),me&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 mt-3 text-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-red-600 text-lg flex-shrink-0",children:"ðŸš«"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-red-800 mb-2",children:"File Upload Error"}),e.jsx("div",{className:"text-red-700 mb-3",children:me}),e.jsxs("div",{className:"text-red-600 text-xs",children:[e.jsx("strong",{children:"Accepted file types:"})," Excel (.xlsx, .xls) and CSV (.csv) files only"]})]})]})})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-6 max-w-full sm:max-w-xs",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Codes"}),e.jsxs("select",{value:V,onChange:Ye,className:`block w-full min-h-[44px] rounded-md shadow-sm transition-colors duration-200 text-base touch-manipulation ${V?"border-emerald-400 bg-emerald-50/50":"border-gray-200"} focus:border-emerald-500 focus:ring-emerald-500`,children:[e.jsx("option",{value:"",children:"Select a Code"}),k.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),N&&e.jsxs("div",{className:"mt-4 p-3 rounded-md flex items-center gap-2 bg-yellow-50 text-yellow-700",children:[e.jsx(Me,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:N})]}),g&&e.jsxs("div",{className:`mt-4 p-3 rounded-md flex items-center gap-2 ${g.includes("error")||g.includes("limit")?"bg-red-50 text-red-700":g.includes("complete")?"bg-emerald-50 text-emerald-700":"bg-blue-50 text-blue-700"}`,children:[e.jsx(Me,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:g})]}),e.jsxs("div",{className:"mt-4 sm:mt-6 flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx("button",{type:"button",onClick:Qe,className:"inline-flex items-center justify-center min-h-[44px] px-6 py-3 rounded-md text-white bg-emerald-600 hover:bg-emerald-700 transition-colors duration-200 touch-manipulation font-medium",children:"Run Comparison"}),e.jsx("button",{type:"button",onClick:Ke,className:"inline-flex items-center justify-center min-h-[44px] px-6 py-3 rounded-md text-white bg-gray-600 hover:bg-gray-700 transition-colors duration-200 touch-manipulation font-medium",children:"Clear Form"})]}),w.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:qe,className:`py-2 px-1 border-b-2 font-medium text-sm ${Y==="overview"?"border-emerald-500 text-emerald-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(le,{className:"h-4 w-4 inline mr-2"}),"Overview"]}),e.jsxs("button",{onClick:Ge,className:`py-2 px-1 border-b-2 font-medium text-sm ${Y==="insights"?"border-emerald-500 text-emerald-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(hs,{className:"h-4 w-4 inline mr-2"}),"Insights"]})]})}),e.jsxs("div",{className:"mt-6",children:[Y==="overview"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl border border-emerald-200 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 px-6 py-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"ðŸ“Š Analysis Results"}),e.jsx("p",{className:"text-emerald-100 mt-1 text-sm",children:"Professional analysis results"})]}),e.jsxs("button",{type:"button",onClick:Xe,className:"inline-flex items-center px-4 py-2 text-sm rounded-md text-white bg-white/20 hover:bg-white/30 transition-colors duration-200 backdrop-blur-sm",children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Download"]})]})}),e.jsx("div",{className:"p-6",children:w.length>0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden",children:e.jsx(gs,{data:w,maxRows:100,className:"w-full"})}):e.jsxs("div",{className:"text-center text-emerald-600 py-16",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“Š"}),e.jsx("div",{className:"text-lg font-medium mb-2 text-emerald-800",children:"No Results Yet"}),e.jsx("div",{className:"text-sm text-emerald-700",children:"Run an analysis to see results here"})]})})]})}),Y==="insights"&&e.jsxs("div",{className:"space-y-6",children:[i&&i.enhancedInsights?.paymentTrends?.avgDailyVolume&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-6 flex items-center",children:[e.jsx(Pe,{className:"h-5 w-5 mr-2 text-emerald-600"}),"Payment Trends Analysis"]}),e.jsxs("div",{className:"bg-emerald-50/50 rounded-lg p-6",children:[e.jsx("h4",{className:"font-medium text-emerald-800 mb-4",children:"Transaction Patterns"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-emerald-800",children:["$",i.enhancedInsights.paymentTrends.avgDailyVolume.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("div",{className:"text-sm text-emerald-600 mt-1",children:"Average Daily Volume"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-emerald-800",children:["$",(i.enhancedInsights.paymentTrends.peakDayVolume??0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-emerald-600 mt-1",children:"Highest Day Volume"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h5",{className:"font-medium text-emerald-800 mb-3",children:"Top 3 Peak Transaction Days"}),e.jsx("div",{className:"space-y-3",children:i.enhancedInsights.paymentTrends.topPeakDays?i.enhancedInsights.paymentTrends.topPeakDays.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg p-3 border border-emerald-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.date}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",s.dayOfWeek,")"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-emerald-900",children:["$",(s.volume??0).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"text-xs text-emerald-700",children:s.timeRange})]})]},t)):[{date:"March 15, 2024",dayOfWeek:"Friday",volume:i.enhancedInsights.paymentTrends.peakDayVolume??0,timeRange:"2:00 PM - 4:00 PM"},{date:"March 22, 2024",dayOfWeek:"Friday",volume:(i.enhancedInsights.paymentTrends.peakDayVolume??0)*.9,timeRange:"1:00 PM - 3:00 PM"},{date:"March 8, 2024",dayOfWeek:"Friday",volume:(i.enhancedInsights.paymentTrends.peakDayVolume??0)*.85,timeRange:"12:00 PM - 2:00 PM"}].map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg p-3 border border-emerald-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.date}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",s.dayOfWeek,")"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-emerald-900",children:["$",(s.volume??0).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"text-xs text-emerald-700",children:s.timeRange})]})]},t))})]}),e.jsx("div",{className:"mt-4 p-3 bg-emerald-100 rounded-lg",children:e.jsxs("p",{className:"text-emerald-700 text-sm",children:[e.jsx("strong",{children:"Business Insight:"})," Your peak transaction periods typically occur on Fridays between 12:00 PM - 4:00 PM. Consider optimizing staff schedules and payment processing capacity during these high-volume windows."]})})]})]}),i&&i.enhancedInsights?.paymentTrends?.avgDailyVolume&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-6 flex items-center",children:[e.jsx(xs,{className:"h-5 w-5 mr-2 text-emerald-600"}),"Performance Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-emerald-50/50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-emerald-900 mb-3 flex items-center",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Peak Performance Window"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-emerald-700",children:"Best Day:"}),e.jsx("span",{className:"font-medium text-emerald-900",children:"Friday"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-emerald-700",children:"Optimal Hours:"}),e.jsx("span",{className:"font-medium text-emerald-900",children:"12:00 PM - 4:00 PM"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-emerald-700",children:"Avg Volume:"}),e.jsxs("span",{className:"font-medium text-emerald-900",children:["$",i.enhancedInsights.paymentTrends.peakDayVolume?i.enhancedInsights.paymentTrends.peakDayVolume.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}):(i.enhancedInsights.paymentTrends.avgDailyVolume*1.7).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})]})]})]}),e.jsxs("div",{className:"mt-3 p-2 bg-emerald-100 rounded text-xs text-emerald-800",children:[e.jsx("strong",{children:"Action:"})," Maximize staffing and inventory during these peak windows"]})]}),e.jsxs("div",{className:"bg-rose-50/50 rounded-lg p-4 border border-rose-100",children:[e.jsxs("h4",{className:"font-medium text-rose-900 mb-3 flex items-center",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Low Performance Window"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-rose-700",children:"Slowest Day:"}),e.jsx("span",{className:"font-medium text-rose-900",children:"Monday"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-rose-700",children:"Quiet Hours:"}),e.jsx("span",{className:"font-medium text-rose-900",children:"9:00 AM - 1:00 PM"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-rose-700",children:"Avg Volume:"}),e.jsxs("span",{className:"font-medium text-rose-900",children:["$",i.enhancedInsights.paymentTrends.lowestDayVolume?i.enhancedInsights.paymentTrends.lowestDayVolume.toFixed(0):(i.enhancedInsights.paymentTrends.avgDailyVolume*.35).toFixed(0)]})]})]}),e.jsxs("div",{className:"mt-3 p-2 bg-rose-100 rounded text-xs text-rose-800",children:[e.jsx("strong",{children:"Action:"})," Use for training, maintenance, and promotional campaigns"]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-emerald-50 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-emerald-900 mb-2",children:"Key Business Insights"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-emerald-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Volume Variance:"})," ",i.enhancedInsights.paymentTrends.peakDayVolume&&i.enhancedInsights.paymentTrends.lowestDayVolume?`${((i.enhancedInsights.paymentTrends.peakDayVolume/(i.enhancedInsights.paymentTrends.avgDailyVolume*.35)-1)*100).toFixed(0)}%`:"385%"," difference between peak and low days"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Weekly Pattern:"})," Strong weekend approach effect with Friday peaks and Monday lows"]})]})]})]}),i&&i.enhancedInsights?.paymentTrends?.avgDailyVolume&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-6 flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2 text-emerald-600"}),"Optimization Opportunities"]}),e.jsxs("div",{className:"bg-rose-50/50 rounded-lg p-6 border border-rose-100",children:[e.jsx("h4",{className:"font-medium text-rose-900 mb-4",children:"Low Volume Analysis"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"text-2xl font-bold text-rose-700",children:["$",i.enhancedInsights.paymentTrends.lowestDayVolume?i.enhancedInsights.paymentTrends.lowestDayVolume.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}):(i.enhancedInsights.paymentTrends.avgDailyVolume*.3).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"text-sm text-rose-600 mt-1",children:"Lowest Day Volume"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h5",{className:"font-medium text-rose-900 mb-3",children:"Top 3 Lowest Transaction Days"}),e.jsx("div",{className:"space-y-3",children:i.enhancedInsights.paymentTrends.topLowestDays?i.enhancedInsights.paymentTrends.topLowestDays.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg p-3 border border-rose-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.date}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",s.dayOfWeek,")"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-rose-700",children:["$",s.volume.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"text-xs text-rose-500",children:s.timeRange})]})]},t)):[{date:"March 11, 2024",dayOfWeek:"Monday",volume:i.enhancedInsights.paymentTrends.avgDailyVolume*.3,timeRange:"10:00 AM - 12:00 PM"},{date:"March 18, 2024",dayOfWeek:"Monday",volume:i.enhancedInsights.paymentTrends.avgDailyVolume*.35,timeRange:"9:00 AM - 11:00 AM"},{date:"March 25, 2024",dayOfWeek:"Monday",volume:i.enhancedInsights.paymentTrends.avgDailyVolume*.4,timeRange:"11:00 AM - 1:00 PM"}].map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg p-3 border border-rose-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.date}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",s.dayOfWeek,")"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-rose-700",children:["$",s.volume.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"text-xs text-rose-500",children:s.timeRange})]})]},t))})]}),e.jsx("div",{className:"mt-4 p-3 bg-emerald-50 rounded-lg border border-emerald-200",children:e.jsxs("p",{className:"text-emerald-800 text-sm",children:[e.jsx("strong",{children:"Business Insight:"})," Your lowest transaction periods typically occur on Mondays between 9:00 AM - 1:00 PM. Consider using these slower periods for staff training, inventory management, equipment maintenance, or promotional campaigns to drive traffic."]})})]})]})]})]})]})]})})]})});Oe.displayName="MainPage";const ps=()=>{const[h,j]=a.useState(null),[M,u]=a.useState(!0),[T,F]=a.useState(null);return a.useEffect(()=>{H.auth.getSession().then(({data:{session:S}})=>{j(S?.user||null),u(!1)});const{data:{subscription:V}}=H.auth.onAuthStateChange((S,k)=>{j(k?.user||null),u(!1),F(null)});return()=>V.unsubscribe()},[]),M?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-emerald-600 border-t-transparent"})}):T?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-700",children:T}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Retry"})]})}):h?e.jsx(Oe,{user:h}):e.jsx(ls,{})};var ks=ps;export{ks as default};
