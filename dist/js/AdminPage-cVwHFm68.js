const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/fileValidator-BKWzj5g2.js","js/xlsx-BBMPxr6S.js","js/bulletproofFileValidator-byQ5H6Lu.js"])))=>i.map(i=>d[i]);
import{_ as Ye}from"./auth-DoljvRgB.js";import{c as Ae,s as ce,j as e,C as Ee,a as jr,Z as ds,X as vr,A as ms,b as xs,S as us,d as ps}from"./index-CTfSqjam.js";import{r as a,b as ve}from"./react-vendor-Fq2Sw-nb.js";import{read as gs,utils as Nr}from"./xlsx-BBMPxr6S.js";import{C as pe}from"./check-circle-2-Cq1Nm1no.js";import{U as ye,S as je}from"./user-XJ-DmsLM.js";import{E as oe,a as Ie}from"./eye-BAbffjCQ.js";import{A as Ns}from"./alert-triangle-CaxGUhZ2.js";import{C as jt}from"./check-circle-Gi7Pviil.js";import{E as wr}from"./external-link-BrywklmV.js";import{M as Sr}from"./message-square-BlCVTLoC.js";import"./router-CFMIZ337.js";import"./admin-utils-lVyF4nhZ.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=Ae("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=Ae("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=Ae("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=Ae("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=Ae("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=Ae("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);let fe=null,bs=0;const Tr=3e4;function Er(){const[l,m]=a.useState(!1),[x,d]=a.useState(!1),[v,b]=a.useState(!1),[y,c]=a.useState(!0),[f,C]=a.useState(null),[V,j]=a.useState(null),N=a.useRef(!0);a.useEffect(()=>{N.current=!0;const R=Date.now();if(fe&&R-bs<Tr){N.current&&(m(fe.isAuthenticated),d(fe.isApproved),b(fe.isPending),c(!1),C(fe.user),j(fe.userStatus));return}(async()=>{try{const{data:{session:u},error:h}=await ce.auth.getSession();if(h){console.warn("Auth session error:",h.message),L(null);return}N.current&&L(u)}catch(u){console.warn("Failed to get initial session:",u),N.current&&L(null)}})();const{data:{subscription:$}}=ce.auth.onAuthStateChange((u,h)=>{N.current&&L(h)});return()=>{N.current=!1,$.unsubscribe()}},[]);const I=R=>{fe={isAuthenticated:l,isApproved:x,isPending:v,isLoading:!1,user:f,userStatus:V,...R},bs=Date.now()},L=async R=>{if(N.current){if(R?.user){const O={isAuthenticated:!0,user:R.user};m(!0),C(R.user);try{if(R.user.email==="davisricart@gmail.com"){if(console.log("Admin email detected - granting admin access"),N.current){const q={...O,userStatus:"approved",isApproved:!0,isPending:!1,isLoading:!1};j("approved"),d(!0),b(!1),c(!1),I(q)}return}const{data:$,error:u}=await ce.from("user_profiles").select("status, approved_at").eq("user_id",R.user.id).single();if(!N.current)return;let h={...O};u&&u.code!=="PGRST116"?(console.warn("User profile fetch error:",u.message),h={...h,userStatus:"pending",isApproved:!1,isPending:!0},j("pending"),d(!1),b(!0)):$?.status==="approved"?(h={...h,userStatus:"approved",isApproved:!0,isPending:!1},j("approved"),d(!0),b(!1)):(h={...h,userStatus:"pending",isApproved:!1,isPending:!0},j("pending"),d(!1),b(!0)),I(h)}catch($){if(console.warn("Error checking user status:",$),N.current){const u={...O,userStatus:"pending",isApproved:!1,isPending:!0};j("pending"),d(!1),b(!0),I(u)}}}else if(N.current){const O={isAuthenticated:!1,isApproved:!1,isPending:!1,user:null,userStatus:null,isLoading:!1};m(!1),d(!1),b(!1),C(null),j(null),I(O)}N.current&&c(!1)}};return{isAuthenticated:l,isApproved:x,isPending:v,isLoading:y,user:f,userStatus:V}}var ws={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},fs=ve.createContext&&ve.createContext(ws),Ar=["attr","size","title"];function Dr(l,m){if(l==null)return{};var x=Rr(l,m),d,v;if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(l);for(v=0;v<b.length;v++)d=b[v],!(m.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(l,d)&&(x[d]=l[d])}return x}function Rr(l,m){if(l==null)return{};var x={};for(var d in l)if(Object.prototype.hasOwnProperty.call(l,d)){if(m.indexOf(d)>=0)continue;x[d]=l[d]}return x}function Qe(){return Qe=Object.assign?Object.assign.bind():function(l){for(var m=1;m<arguments.length;m++){var x=arguments[m];for(var d in x)Object.prototype.hasOwnProperty.call(x,d)&&(l[d]=x[d])}return l},Qe.apply(this,arguments)}function ys(l,m){var x=Object.keys(l);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(l);m&&(d=d.filter(function(v){return Object.getOwnPropertyDescriptor(l,v).enumerable})),x.push.apply(x,d)}return x}function Xe(l){for(var m=1;m<arguments.length;m++){var x=arguments[m]!=null?arguments[m]:{};m%2?ys(Object(x),!0).forEach(function(d){Ur(l,d,x[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(x)):ys(Object(x)).forEach(function(d){Object.defineProperty(l,d,Object.getOwnPropertyDescriptor(x,d))})}return l}function Ur(l,m,x){return m=Pr(m),m in l?Object.defineProperty(l,m,{value:x,enumerable:!0,configurable:!0,writable:!0}):l[m]=x,l}function Pr(l){var m=Lr(l,"string");return typeof m=="symbol"?m:m+""}function Lr(l,m){if(typeof l!="object"||!l)return l;var x=l[Symbol.toPrimitive];if(x!==void 0){var d=x.call(l,m);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(l)}function Ss(l){return l&&l.map((m,x)=>ve.createElement(m.tag,Xe({key:x},m.attr),Ss(m.child)))}function St(l){return m=>ve.createElement(Fr,Qe({attr:Xe({},l.attr)},m),Ss(l.child))}function Fr(l){var m=x=>{var{attr:d,size:v,title:b}=l,y=Dr(l,Ar),c=v||x.size||"1em",f;return x.className&&(f=x.className),l.className&&(f=(f?f+" ":"")+l.className),ve.createElement("svg",Qe({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},x.attr,d,y,{className:f,style:Xe(Xe({color:l.color||x.color},x.style),l.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),b&&ve.createElement("title",null,b),l.children)};return fs!==void 0?ve.createElement(fs.Consumer,null,x=>m(x)):m(ws)}function Ir(l){return St({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"16 18 22 12 16 6"},child:[]},{tag:"polyline",attr:{points:"8 6 2 12 8 18"},child:[]}]})(l)}const Or=async()=>{try{const{data:{user:l}}=await ce.auth.getUser();if(!l)return{isAdmin:!1,error:"User not authenticated"};const m=l.email||"",x=m==="davisricart@gmail.com";if(x)return console.log("🚨 ADMIN BYPASS: Granting admin access to owner:",m),{isAdmin:!0,userEmail:m,message:"Owner admin access granted"};if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.port==="3000"||window.location.origin.includes("localhost"))return console.log("🔧 DEVELOPMENT MODE: Bypassing server verification"),console.log("🔧 Current hostname:",window.location.hostname),{isAdmin:x,userEmail:m,message:x?"Development mode: Owner access":"Development mode: Not owner"};const{data:{session:d}}=await ce.auth.getSession(),v=await fetch("/.netlify/functions/verify-admin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d?.access_token}`}});if(!v.ok){const y=await v.json();return console.warn("Admin verification failed:",y),{isAdmin:!1,error:y.error||"Verification failed"}}return await v.json()}catch(l){return console.error("Error verifying admin access:",l),{isAdmin:!1,error:"Network error during admin verification"}}},$r=()=>{const[l,m]=a.useState(!1),[x,d]=a.useState(!0),[v,b]=a.useState(null);return a.useEffect(()=>{const y=async()=>{d(!0),b(null);const f=await Or();m(f.isAdmin),f.error&&b(f.error),d(!1)},{data:{subscription:c}}=ce.auth.onAuthStateChange((f,C)=>{C?.user?y():(m(!1),d(!1),b(null))});return()=>c.unsubscribe()},[]),{isAdmin:l,isLoading:x,error:v}};function js(l){return St({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M4.083 9h1.946c.089-1.546.383-2.97.837-4.118A6.004 6.004 0 004.083 9zM10 2a8 8 0 100 16 8 8 0 000-16zm0 2c-.076 0-.232.032-.465.262-.238.234-.497.623-.737 1.182-.389.907-.673 2.142-.766 3.556h3.936c-.093-1.414-.377-2.649-.766-3.556-.24-.56-.5-.948-.737-1.182C10.232 4.032 10.076 4 10 4zm3.971 5c-.089-1.546-.383-2.97-.837-4.118A6.004 6.004 0 0115.917 9h-1.946zm-2.003 2H8.032c.093 1.414.377 2.649.766 3.556.24.56.5.948.737 1.182.233.23.389.262.465.262.076 0 .232-.032.465-.262.238-.234.498-.623.737-1.182.389-.907.673-2.142.766-3.556zm1.166 4.118c.454-1.147.748-2.572.837-4.118h1.946a6.004 6.004 0 01-2.783 4.118zm-6.268 0C6.412 13.97 6.118 12.546 6.03 11H4.083a6.004 6.004 0 002.783 4.118z",clipRule:"evenodd"},child:[]}]})(l)}function wt(l){return St({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"},child:[]}]})(l)}async function Mr(l){const{validateFile:m}=await Ye(async()=>{const{validateFile:d}=await import("./fileValidator-BKWzj5g2.js");return{validateFile:d}},__vite__mapDeps([0,1])),x=await m(l);if(!x.isValid){const d=x.securityWarning?`🚨 SECURITY: ${x.error} - ${x.securityWarning}`:x.error||"File validation failed";throw new Error(d)}return new Promise((d,v)=>{const b=new FileReader;b.onload=y=>{try{const c=y.target?.result;let f;l.name.endsWith(".csv")?f=gs(c,{type:"binary"}):f=gs(c,{type:"array"});const C=f.SheetNames[0],V=f.Sheets[C],j=Nr.sheet_to_json(V,{header:1});if(j.length===0)throw new Error("File appears to be empty");const N=j[0],L=j.slice(1).map(O=>{const $={};return N.forEach((u,h)=>{$[u]=O[h]??""}),$}),R={filename:l.name,headers:N,rows:L,summary:{totalRows:L.length,columns:N.length,sampleData:L.slice(0,5)}};d(R)}catch(c){v(new Error(`Failed to parse file: ${c}`))}},b.onerror=()=>v(new Error("Failed to read file")),l.name.endsWith(".csv")?b.readAsBinaryString(l):b.readAsArrayBuffer(l)})}const vs={starter:{monthly:19,annual:15},professional:{monthly:34,annual:27},business:{monthly:59,annual:47}};function zr({pendingUsers:l,onMoveToTesting:m,onRejectUser:x,onUpdatePendingUser:d,isLoading:v}){const[b,y]=a.useState(null),[c,f]=a.useState(null),[C,V]=a.useState(null),[j,N]=a.useState(null),[I,L]=a.useState({}),R=async u=>{y(u.id);try{await m(u.id,{id:u.id,email:u.email,businessName:u.businessName,businessType:u.businessType,subscriptionTier:u.subscriptionTier,billingCycle:u.billingCycle,createdAt:u.createdAt,readyForTestingAt:new Date().toISOString(),qaStatus:"pending",websiteProvisioned:!1,scriptDeployed:!1})}finally{y(null),N(null)}},O=async(u,h,q)=>{const _=!q;L(ae=>({...ae,[u]:{...ae[u],[h]:_}})),y(u);try{await d(u,{[h]:_}),L(ae=>{const{[u]:De,...n}=ae;return n})}catch(ae){throw L(De=>{const{[u]:n,...p}=De;return p}),ae}finally{y(null)}},$=async(u,h)=>{y(u);try{await x(u,h||void 0)}finally{y(null),V(null)}};return l.length===0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pending Approvals"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review and manage consultation workflow"})]})]})}),e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(pe,{className:"h-8 w-8 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-500 max-w-sm mx-auto",children:"No pending user approvals at the moment. New registrations will appear here for review."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-100",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pending Approvals"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l.length," user",l.length!==1?"s":""," awaiting consultation completion"]})]})]})})}),e.jsx("div",{className:"divide-y divide-gray-100",children:l.map(u=>{const h={...u,...I[u.id]},q=h.consultationCompleted&&h.scriptReady,_=b===u.id;return e.jsxs("div",{className:"p-4 hover:bg-gray-50/50 transition-colors border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg flex-shrink-0",children:e.jsx(ye,{className:"h-4 w-4 text-slate-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate text-sm",children:u.email}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0 ${h.subscriptionTier==="business"?"bg-purple-100 text-purple-700":h.subscriptionTier==="professional"?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"}`,children:h.subscriptionTier})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cr,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"truncate",children:u.businessName})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(jr,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{children:new Date(u.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsxs("span",{className:"font-medium text-green-600",children:["$",u.billingCycle==="annual"?vs[u.subscriptionTier]?.annual||0:vs[u.subscriptionTier]?.monthly||0,"/",(u.billingCycle==="annual","mo")]}),u.billingCycle==="annual"&&e.jsx("span",{className:"text-green-500 font-medium",children:"📅"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>O(u.id,"consultationCompleted",h.consultationCompleted||!1),disabled:_,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all hover:scale-105 disabled:opacity-50 disabled:hover:scale-100 ${h.consultationCompleted?"bg-emerald-100 text-emerald-700 border border-emerald-200 hover:bg-emerald-200":"bg-amber-100 text-amber-700 border border-amber-200 hover:bg-amber-200"}`,title:"Click to toggle consultation status",children:[h.consultationCompleted?e.jsx(pe,{className:"h-3 w-3"}):e.jsx(Ee,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:h.consultationCompleted?"Consult":"Pending"})]}),e.jsxs("button",{onClick:()=>O(u.id,"scriptReady",h.scriptReady||!1),disabled:_,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all hover:scale-105 disabled:opacity-50 disabled:hover:scale-100 ${h.scriptReady?"bg-emerald-100 text-emerald-700 border border-emerald-200 hover:bg-emerald-200":"bg-amber-100 text-amber-700 border border-amber-200 hover:bg-amber-200"}`,title:"Click to toggle script ready status",children:[h.scriptReady?e.jsx(pe,{className:"h-3 w-3"}):e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:h.scriptReady?"Script":"Building"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${q?"bg-emerald-500":h.consultationCompleted||h.scriptReady?"bg-amber-400":"bg-gray-300"}`,style:{width:`${q?100:(h.consultationCompleted?50:0)+(h.scriptReady?50:0)}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500 font-medium min-w-0",children:[(h.consultationCompleted?1:0)+(h.scriptReady?1:0),"/2"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>N(u.id),disabled:!q||_,className:`inline-flex items-center gap-1.5 px-4 py-1.5 rounded-md text-xs font-medium transition-all hover:scale-105 ${q&&!_?"bg-blue-600 text-white hover:bg-blue-700 shadow-sm":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:q?"Move to Testing stage - consultation and script ready":"Complete consultation and script development first",children:[e.jsx(ds,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"To Testing"})]}),e.jsx("button",{onClick:()=>f(u),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-md transition-colors",title:"View Details",children:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>V(u.id),disabled:_||v,className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors disabled:opacity-50",title:"Reject User",children:e.jsx(vr,{className:"h-3 w-3"})})]})]}),C===u.id&&e.jsx("div",{className:"bg-red-50 border-t border-red-200 p-4 rounded-b-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(Ns,{className:"h-4 w-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-red-900",children:"Confirm Rejection"}),e.jsx("p",{className:"text-sm text-red-700",children:"Are you sure you want to reject this user? This action cannot be undone."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>V(null),className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 border border-gray-300 rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>$(u.id),disabled:_,className:"px-3 py-1.5 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors disabled:opacity-50",children:_?"Rejecting...":"Reject User"})]})]})}),j===u.id&&e.jsx("div",{className:"bg-blue-50 border-t border-blue-200 p-4 rounded-b-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ds,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Move to Testing Stage"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Ready to move ",u.email," to testing stage?",e.jsx("span",{className:"font-medium",children:" In Testing, their website will be provisioned and scripts deployed for QA testing."})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(null),className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 border border-gray-300 rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>R(u),disabled:_,className:"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors disabled:opacity-50",children:_?"Moving...":"Move to Testing"})]})]})})]},u.id)})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full shadow-2xl border border-gray-200",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(ye,{className:"h-5 w-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"User Details"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Registration information"})]})]})}),e.jsx("div",{className:"px-6 py-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("p",{className:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-lg",children:c.email})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name"}),e.jsx("p",{className:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-lg",children:c.businessName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Type"}),e.jsx("p",{className:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-lg",children:c.businessType})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subscription Tier"}),e.jsx("span",{className:`inline-flex items-center px-3 py-2 rounded-lg text-sm font-medium ${c.subscriptionTier==="business"?"bg-purple-100 text-purple-700":c.subscriptionTier==="professional"?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"}`,children:c.subscriptionTier})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Cycle"}),e.jsx("p",{className:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-lg",children:c.billingCycle})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Registration Date"}),e.jsx("p",{className:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-lg",children:new Date(c.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Consultation Status"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`flex-1 p-3 rounded-lg border ${c.consultationCompleted?"bg-emerald-50 border-emerald-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.consultationCompleted?e.jsx(pe,{className:"h-4 w-4 text-emerald-600"}):e.jsx(Ee,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Consultation"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:c.consultationCompleted?"Completed":"Pending"})]}),e.jsxs("div",{className:`flex-1 p-3 rounded-lg border ${c.scriptReady?"bg-emerald-50 border-emerald-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.scriptReady?e.jsx(pe,{className:"h-4 w-4 text-emerald-600"}):e.jsx(je,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Script"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:c.scriptReady?"Ready":"Building"})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>f(null),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Close"}),e.jsx("button",{onClick:()=>{R(c),f(null)},disabled:b===c.id||v||!c.consultationCompleted||!c.scriptReady,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors",children:c.consultationCompleted&&c.scriptReady?"Move to Testing":"Not Ready"})]})]})})]})}function Br({readyForTestingUsers:l,onFinalApprove:m,onSendBackToPending:x,onUpdateTestingUser:d,isLoading:v}){const[b,y]=a.useState(null),[c,f]=a.useState({}),[C,V]=a.useState({}),[j,N]=a.useState({}),[I,L]=a.useState({}),[R,O]=a.useState(null);a.useEffect(()=>{const n=async()=>{console.log("🔄 CHECKING PERSISTENT WEBSITE STATUS - Loading from Supabase...");const p="https://qkrptazfydtaoyhhczyr.supabase.co",k="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrcnB0YXpmeWR0YW95aGhjenlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjk4MjEsImV4cCI6MjA2NTk0NTgyMX0.1RMndlLkNeztTMsWP6_Iu8Q0VNGPYRp2H9ij7OJQVaM";try{const T=l.map(E=>E.id).join(","),U=await fetch(`${p}/rest/v1/clients?id=in.(${T})&select=id,client_path,website_created`,{method:"GET",headers:{apikey:k,Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});if(U.ok){const E=await U.json();console.log("📊 Supabase persistence check:",E.length,"existing websites found");const A={};E.forEach(P=>{P.website_created&&(A[P.id]="created",console.log("✅ PERSISTENT: Website exists for",P.id,"→",P.client_path))}),Object.keys(A).length>0&&(L(P=>({...P,...A})),console.log("🎯 PERSISTENT STATUS RESTORED:",Object.keys(A).length,"websites"))}else console.warn("⚠️ Failed to load persistent website status")}catch(T){console.error("❌ Error checking persistent website status:",T)}};l.length>0&&n()},[l]);const $=async(n,p)=>{y(n);try{const k={qaStatus:p};(p==="passed"||p==="failed")&&(k.qaTestedAt=new Date().toISOString()),c[n]&&(k.qaTestingNotes=c[n]),await d(n,k),f(T=>({...T,[n]:""}))}finally{y(null)}},u=async n=>{y(n.id);try{const p={id:n.id,email:n.email,businessName:n.businessName,businessType:n.businessType,subscriptionTier:n.subscriptionTier,billingCycle:n.billingCycle,comparisonsUsed:0,comparisonsLimit:100,status:"approved",approvedAt:new Date().toISOString(),createdAt:n.createdAt},[k,T]=await Promise.all([m(n.id,p),fetch("/.netlify/functions/approve-client-live",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:n.id,userData:p})})]);if(T.ok){const U=await T.json();console.log("🎯 Client LIVE approved in database:",U)}console.log("✅ Client fully approved and LIVE:",n.id)}finally{y(null)}},h=n=>{O(n)},q=async n=>{O(null),y(n);try{await x(n,"Sent back from QA testing"),console.log("🧨 LIVE COMPLETE RESET: Erasing all traces of client:",n);try{const p="https://qkrptazfydtaoyhhczyr.supabase.co",k="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrcnB0YXpmeWR0YW95aGhjenlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjk4MjEsImV4cCI6MjA2NTk0NTgyMX0.1RMndlLkNeztTMsWP6_Iu8Q0VNGPYRp2H9ij7OJQVaM";(await fetch(`${p}/rest/v1/clients?id=eq.${n}`,{method:"DELETE",headers:{apikey:k,Authorization:`Bearer ${k}`,"Content-Type":"application/json"}})).ok?console.log("✅ LIVE Supabase deletion completed for client:",n):console.warn("⚠️ Supabase deletion failed - continuing with local reset")}catch(p){console.warn("⚠️ Data wipe failed - continuing with local reset:",p)}L(p=>({...p,[n]:"none"})),N(p=>({...p,[n]:"none"})),V(p=>{const k={...p};return delete k[n],k}),f(p=>({...p,[n]:""})),console.log("🎯 LIVE RESET: Client never existed - fresh start ready")}finally{y(null)}},_=async n=>{const p=l.find(U=>U.id===n);if(!p)return;const k=C[n]||p.businessName?.toLowerCase().replace(/[^a-z0-9]/g,"")||p.email?.split("@")[0]?.toLowerCase().replace(/[^a-z0-9]/g,"")||"client",T=document.createElement("input");T.type="file",T.accept=".js,.ts",T.onchange=async U=>{const E=U.target.files?.[0];if(E){y(n);try{const A=await E.text();console.log("📤 Uploading script to GitHub + database:",{filename:E.name,clientPath:k,size:E.size});const P="https://qkrptazfydtaoyhhczyr.supabase.co",Z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrcnB0YXpmeWR0YW95aGhjenlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjk4MjEsImV4cCI6MjA2NTk0NTgyMX0.1RMndlLkNeztTMsWP6_Iu8Q0VNGPYRp2H9ij7OJQVaM",w={id:E.name.replace(/\.(js|ts)$/,""),name:E.name.replace(/\.(js|ts)$/,""),content:A,uploaded_at:new Date().toISOString()},Y=await fetch(`${P}/rest/v1/clients?id=eq.${n}`,{method:"PATCH",headers:{apikey:Z,Authorization:`Bearer ${Z}`,"Content-Type":"application/json"},body:JSON.stringify({deployed_scripts:[w]})});if(!Y.ok)throw new Error(`Script upload failed: ${Y.statusText}`);console.log("✅ Script uploaded to Supabase successfully:",w),N(H=>({...H,[n]:"ready"})),console.log(`✅ Script "${E.name}" uploaded and saved to GitHub + database!`)}catch(A){console.error("❌ Error uploading script:",A)}finally{y(null)}}},T.click()},ae=async n=>{y(n);try{console.log("🧪 Testing script for user:",n),await new Promise(p=>setTimeout(p,1500)),N(p=>({...p,[n]:"completed"})),console.log("✅ Script testing completed for user:",n)}catch(p){console.error("❌ Error testing script:",p)}finally{y(null)}},De=async n=>{y(n);try{const p=l.find(H=>H.id===n);if(!p)throw new Error("User not found");const k=C[n]||p.businessName?.toLowerCase().replace(/[^a-z0-9]/g,"")||p.email?.split("@")[0]?.toLowerCase().replace(/[^a-z0-9]/g,"")||"client";console.log("🏗️ Creating LIVE website for:",{userId:n,clientPath:k,businessName:p.businessName}),console.log("🔄 CACHE BUST v3.0 - DIRECT SUPABASE CALL EXECUTING"),console.log("🚀 Using direct Supabase API - NO NETLIFY FUNCTIONS!");const T="https://qkrptazfydtaoyhhczyr.supabase.co",U="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrcnB0YXpmeWR0YW95aGhjenlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjk4MjEsImV4cCI6MjA2NTk0NTgyMX0.1RMndlLkNeztTMsWP6_Iu8Q0VNGPYRp2H9ij7OJQVaM",E={id:n,client_path:k,business_name:p.businessName,email:p.email,subscription_tier:p.subscriptionTier,website_created:!0,website_created_at:new Date().toISOString(),status:"testing",site_url:`https://grbalance.netlify.app/${k}`,deployed_scripts:[],usage:{comparisons_used:0,comparisons_limit:p.subscriptionTier==="business"?500:p.subscriptionTier==="professional"?200:100}};console.log("📡 Making direct Supabase API call to:",`${T}/rest/v1/clients`),console.log("📦 Client data payload:",E);const P=await(await fetch(`${T}/rest/v1/clients?id=eq.${n}`,{method:"GET",headers:{apikey:U,Authorization:`Bearer ${U}`,"Content-Type":"application/json"}})).json(),Z=P&&P.length>0;console.log("🔍 Client exists check:",Z?"YES - will UPDATE":"NO - will CREATE");let w;if(Z?(w=await fetch(`${T}/rest/v1/clients?id=eq.${n}`,{method:"PATCH",headers:{apikey:U,Authorization:`Bearer ${U}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(E)}),console.log("📨 UPDATE response status:",w.status)):(w=await fetch(`${T}/rest/v1/clients`,{method:"POST",headers:{apikey:U,Authorization:`Bearer ${U}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(E)}),console.log("📨 CREATE response status:",w.status)),!w.ok){const H=await w.text();throw console.error("❌ Supabase direct error:",w.status,H),new Error(`Supabase API error: ${w.status} ${H}`)}const Y=await w.json();console.log("✅ LIVE Website processed directly in Supabase:",Y),L(H=>({...H,[n]:"created"})),console.log("🔍 Current clientPath after creation:",k),console.log("🔍 CustomUrls state:",C[n])}catch(p){console.error("❌ Error creating website:",p)}finally{y(null)}};return l.length===0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(oe,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"QA Testing"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Internal testing before client approval"})]})]})}),e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(pe,{className:"h-8 w-8 text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No sites ready for testing"}),e.jsx("p",{className:"text-gray-500 max-w-sm mx-auto",children:"Users will appear here after consultation and script development are complete."})]})]}):e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(oe,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"QA Testing"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l.length," client",l.length!==1?"s":""," ready for internal testing"]})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:l.some(n=>I[n.id]==="created")?e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-gray-400 text-xs",children:"Client Portals:"}),l.filter(n=>I[n.id]==="created").map(n=>{const p=C[n.id]||n.businessName?.toLowerCase().replace(/[^a-z0-9]/g,"")||n.email?.split("@")[0]?.toLowerCase().replace(/[^a-z0-9]/g,"")||"client";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600 text-xs",children:[n.businessName,":"]}),e.jsxs("a",{href:`https://grbalance.netlify.app/${p}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-800 underline font-medium text-xs",children:["grbalance.netlify.app/",p]})]},n.id)})]}):e.jsx("span",{children:"Created client portals appear as clickable links below each client"})})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:l.map(n=>{const p=n.qaStatus||"pending",k=p==="passed",U=(j[n.id]||"none")==="completed",E=k&&U,A=b===n.id,P=n.businessName?.toLowerCase().replace(/[^a-z0-9]/g,"")||n.email?.split("@")[0]?.toLowerCase().replace(/[^a-z0-9]/g,"")||"client",Z=C[n.id]||P;return e.jsxs("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:n.businessName||"Business Name Not Set"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${n.subscriptionTier==="business"?"bg-purple-100 text-purple-800":n.subscriptionTier==="professional"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:n.subscriptionTier})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[e.jsx("span",{children:n.email}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Ready ",new Date(n.readyForTestingAt).toLocaleDateString()]})]}),I[n.id]!=="created"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Client Portal URL:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"grbalance.netlify.app/"}),e.jsx("input",{type:"text",value:C[n.id]!==void 0?C[n.id]:P,onChange:w=>V(Y=>({...Y,[n.id]:w.target.value.toLowerCase().replace(/[^a-z0-9]/g,"")})),placeholder:"Enter client portal name...",className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400 max-w-xs",onFocus:w=>{C[n.id]===void 0&&V(Y=>({...Y,[n.id]:""}))}})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[I[n.id]==="created"?e.jsxs("a",{href:`https://grbalance.netlify.app/${Z}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-3 py-1.5 bg-green-100 text-green-700 rounded-md text-sm font-medium hover:bg-green-200 transition-colors border border-green-200",children:[e.jsx(jt,{className:"h-3 w-3"}),e.jsx("span",{children:"Website Ready"}),e.jsxs("span",{className:"text-xs",children:["/",Z]}),e.jsx(wr,{className:"h-3 w-3"})]}):e.jsx("button",{onClick:()=>De(n.id),disabled:A,className:"inline-flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-md text-sm font-medium hover:bg-blue-200 transition-colors border border-blue-200 hover:scale-105 disabled:opacity-50",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-blue-700 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Creating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(kr,{className:"h-3 w-3"}),e.jsx("span",{children:"Create Website"})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>$(n.id,p==="testing"?"passed":"testing"),disabled:A,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all hover:scale-105 disabled:opacity-50 ${p==="passed"?"bg-emerald-100 text-emerald-700 border border-emerald-200":p==="testing"?"bg-blue-100 text-blue-700 border border-blue-200":"bg-amber-100 text-amber-700 border border-amber-200"}`,children:p==="passed"?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3 w-3"}),e.jsx("span",{children:"QA Passed"})]}):p==="testing"?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-3 w-3"}),e.jsx("span",{children:"Testing"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"h-3 w-3"}),e.jsx("span",{children:"Start QA"})]})}),p!=="pending"&&e.jsxs("button",{onClick:()=>$(n.id,"failed"),disabled:A,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium bg-red-100 text-red-700 border border-red-200 hover:bg-red-200 transition-all hover:scale-105 disabled:opacity-50",children:[e.jsx(ms,{className:"h-3 w-3"}),e.jsx("span",{children:"Fail"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(n),disabled:A||!E,className:`flex items-center gap-1.5 px-4 py-1.5 rounded-md text-xs font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed ${E?"bg-emerald-600 text-white hover:bg-emerald-700 shadow-sm hover:shadow-md hover:scale-105":"bg-gray-100 text-gray-400"}`,children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Approving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3 w-3"}),e.jsx("span",{children:E?"Go Live":k?"Script Completion Required":"QA Required"})]})}),e.jsxs("button",{onClick:()=>h(n.id),disabled:A,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium bg-gray-100 text-gray-600 hover:bg-gray-200 transition-all hover:scale-105 disabled:opacity-50",children:[e.jsx(Sr,{className:"h-3 w-3"}),e.jsx("span",{children:"Send Back"})]})]})]})]}),e.jsxs("div",{className:"mt-3 ml-0",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-2",children:"Reconciliation Script Workflow:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>_(n.id),disabled:A,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all hover:scale-105 disabled:opacity-50 ${j[n.id]==="ready"||j[n.id]==="completed"?"bg-green-100 text-green-700 border border-green-200":"bg-blue-100 text-blue-700 border border-blue-200 hover:bg-blue-200"}`,children:[e.jsx(Oe,{className:"h-3 w-3"}),e.jsx("span",{children:j[n.id]==="ready"||j[n.id]==="completed"?"Script Ready":"Upload Script"})]}),e.jsx("button",{onClick:()=>ae(n.id),disabled:A||!j[n.id]||j[n.id]==="none",className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all hover:scale-105 disabled:opacity-50 ${j[n.id]==="completed"?"bg-emerald-100 text-emerald-700 border border-emerald-200":j[n.id]==="ready"?"bg-amber-100 text-amber-700 border border-amber-200 hover:bg-amber-200":"bg-gray-100 text-gray-400 border border-gray-200"}`,children:A&&j[n.id]==="ready"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-amber-700 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"h-3 w-3"}),e.jsx("span",{children:j[n.id]==="completed"?"Completed":"Test Script"})]})})]})]}),e.jsx("div",{className:"mt-3 ml-0",children:e.jsx("textarea",{value:c[n.id]||n.qaTestingNotes||"",onChange:w=>f(Y=>({...Y,[n.id]:w.target.value})),placeholder:"Add QA testing notes...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-xs resize-none focus:ring-blue-500 focus:border-blue-500",rows:2})})]})}),R===n.id&&e.jsx("div",{className:"mt-3 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ms,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800 mb-1",children:"Send Back to Pending?"}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"This will move the client back to pending status and remove all website/script data. Are you sure?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>q(n.id),disabled:b===n.id,className:"flex items-center gap-1.5 px-3 py-1.5 bg-amber-600 text-white rounded-md text-sm font-medium hover:bg-amber-700 transition-colors disabled:opacity-50",children:b===n.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Sending Back..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"h-3 w-3"}),e.jsx("span",{children:"Yes, Send Back"})]})}),e.jsx("button",{onClick:()=>O(null),disabled:b===n.id,className:"px-3 py-1.5 bg-gray-100 text-gray-600 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]})})]},n.id)})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[l.filter(n=>n.qaStatus==="passed").length," of ",l.length," passed QA"]}),e.jsx("span",{children:"Single-site testing workflow"})]})})]})}const ue={starter:50,professional:75,business:150},Vr=()=>{const{isAdmin:l,isLoading:m,error:x}=$r(),{user:d,isLoading:v}=Er(),b=!1,y={email:"davisricart@gmail.com"},[c,f]=a.useState("users"),[C,V]=a.useState(""),[j,N]=a.useState("all"),[I,L]=a.useState("all"),[R,O]=a.useState("approvedAt"),[$,u]=a.useState("desc"),[h,q]=a.useState(null),[_,ae]=a.useState(null),[De,n]=a.useState({}),[p,k]=a.useState([]),[T,U]=a.useState(!1),[E,A]=a.useState([]),[P,Z]=a.useState("initializing"),[w,Y]=a.useState([]),[H,Ze]=a.useState([]),[ge,Ct]=a.useState([]),[ne,kt]=a.useState([]),[K,Tt]=a.useState([]),[Et,Ke]=a.useState(!0),[Cs,$e]=a.useState(!1),[ks,Me]=a.useState(!1),[Ts,At]=a.useState(""),[Ne,Dt]=a.useState({isOpen:!1,title:"",message:"",confirmText:"",confirmStyle:"",onConfirm:()=>{}}),[S,we]=a.useState({email:"",businessName:"",businessType:"",subscriptionTier:"professional",billingCycle:"monthly"}),[et,tt]=a.useState({name:"",file:null,clientId:""}),[ze,st]=a.useState({email:"",password:""}),[rt,Es]=a.useState(!1),[Rt,Ut]=a.useState(!1),[Pt,at]=a.useState(""),[W,Re]=a.useState({currentPassword:"",newEmail:"",newPassword:"",confirmPassword:""}),[M,Be]=a.useState({current:!1,new:!1,confirm:!1}),[Ve,_r]=a.useState(!1),[Lt,Ft]=a.useState(""),[It,Hr]=a.useState(""),[nt,Ot]=a.useState({}),[ee,_e]=a.useState({}),[$t,Wr]=a.useState({}),[As,it]=a.useState(!1),[Q,lt]=a.useState(null),[F,he]=a.useState({scriptName:"",scriptContent:""}),[Ds,Mt]=a.useState("all"),[Rs,zt]=a.useState("all"),[Us,ot]=a.useState(!1),[He,ct]=a.useState(null),[z,Se]=a.useState({businessName:"",businessType:"",subscriptionTier:"professional",billingCycle:"monthly",adminNotes:""}),[Jr,Ps]=a.useState({selectedUser:"",scriptContent:"",previewMode:"desktop"}),[Gr,qr]=a.useState(null),[Yr,Qr]=a.useState(null),[Xr,Zr]=a.useState(null),[Kr,ea]=a.useState(null),[ta,sa]=a.useState(""),[ra,aa]=a.useState(""),[na,ia]=a.useState({file1:!1,file2:!1}),[Bt,dt]=a.useState(""),[Ce,mt]=a.useState([]),[ke,xt]=a.useState([]),[la,oa]=a.useState("development"),[We,Ls]=a.useState({}),[G,ca]=a.useState(null),[Fs,Vt]=a.useState(!1),[_t,Ht]=a.useState([]),[Is,ut]=a.useState([]),[da,Wt]=a.useState({}),[ma,xa]=a.useState([]),[ua,pa]=a.useState([]),[ga,ha]=a.useState(""),[ba,fa]=a.useState(!1),[ya,ja]=a.useState(!1),[va,Na]=a.useState([]),[wa,Sa]=a.useState(!1),[Ca,ka]=a.useState([]),[Ta,Ea]=a.useState({}),[Aa,Da]=a.useState(!1),[Ra,Ua]=a.useState(null),[Pa,La]=a.useState({}),[Fa,Ia]=a.useState(null),[Oa,$a]=a.useState(!1),[Ma,za]=a.useState(!1),[Ba,Va]=a.useState({file1:null,file2:null}),[de,pt]=a.useState(""),[te,Je]=a.useState(""),[Jt,gt]=a.useState(""),[Te,ht]=a.useState("paste"),[X,Ue]=a.useState(null),[Os,bt]=a.useState(!1),[_a,$s]=a.useState(!1),[Ms,Gt]=a.useState(!1),[qt,Yt]=a.useState(""),[Qt,Xt]=a.useState(""),[se,Zt]=a.useState([]),[re,Kt]=a.useState([]),[zs,es]=a.useState(""),[Bs,ts]=a.useState(""),Ge=(t,s,r)=>{Wt(o=>({...o,[t]:{type:s,message:r}})),setTimeout(()=>{Wt(o=>{const g={...o};return delete g[t],g})},s==="error"?5e3:3e3)},B=(t,s,r)=>{const i=`notification-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o={id:i,type:t,title:s,message:r,timestamp:Date.now()};ut(g=>[...g,o]),setTimeout(()=>{ut(g=>g.filter(D=>D.id!==i))},5e3)},Vs=t=>{ut(s=>s.filter(r=>r.id!==t))},ss=a.useMemo(()=>{let t=[];return c==="approved"?t=ne:t=[],t=t.filter(s=>s&&s.id&&s.email),C&&(t=t.filter(s=>s.email.toLowerCase().includes(C.toLowerCase())||s.businessName&&s.businessName.toLowerCase().includes(C.toLowerCase()))),I!=="all"&&(t=t.filter(s=>s.subscriptionTier===I)),j!=="all"&&(t=t.filter(s=>s.status===j)),t.sort((s,r)=>{let i="",o="";switch(R){case"email":i=s.email,o=r.email;break;case"businessName":i=s.businessName||"",o=r.businessName||"";break;case"subscriptionTier":i=s.subscriptionTier||"",o=r.subscriptionTier||"";break;case"approvedAt":default:i=s.approvedAt,o=r.approvedAt;break}return $==="asc"?i.localeCompare(o):o.localeCompare(i)}),t},[ne,C,I,j,R,$,c]);a.useEffect(()=>{const t=window.alert;return window.alert=s=>{typeof s=="string"&&(s.toLowerCase().includes("success")||s.toLowerCase().includes("deployed")?B("success","Operation Successful",s):s.toLowerCase().includes("error")||s.toLowerCase().includes("failed")?B("error","Operation Failed",s):B("info","System Message",s))},()=>{window.alert=t}},[]);const _s=async()=>{try{const t=collection(db,"clients"),s=await getDocs(t),r=[];s.forEach(i=>{r.push({id:i.id,...i.data()})}),Y(r)}catch(t){console.error("🚨 DATABASE ERROR in fetchClients:"),console.error("🚨 Error Code:",t.code),console.error("🚨 Error Message:",t.message),console.error("🚨 Full Error Object:",t),console.error("🚨 Auth State:",d?"authenticated":"not authenticated"),console.error("🚨 User Email:",d?.email)}},qe=async()=>{try{const t=await safeFetchPendingUsers();Ze(t)}catch(t){console.error("🚨 DATABASE ERROR in fetchPendingUsers:"),console.error("🚨 Error Code:",t.code),console.error("🚨 Error Message:",t.message),console.error("🚨 Full Error Object:",t),console.error("🚨 Auth State:",d?"authenticated":"not authenticated"),Ze([])}},Pe=async()=>{try{const t=collection(db,"ready-for-testing"),s=query(t,orderBy("readyForTestingAt","desc")),r=await getDocs(s),i=[];r.forEach(o=>{i.push({id:o.id,...o.data()})}),Ct(i)}catch(t){console.error("🚨 DATABASE ERROR in fetchReadyForTestingUsers:"),console.error("🚨 Error Code:",t.code),console.error("🚨 Error Message:",t.message),console.error("🚨 Full Error Object:",t),console.error("🚨 Auth State:",d?"authenticated":"not authenticated"),Ct([])}},ie=async()=>{try{const t=collection(db,"usage"),s=query(t,where("status","in",["approved","deactivated","deleted"])),r=await getDocs(s),i=[],o=[],g={},D={},J={};r.forEach(me=>{const xe={id:me.id,...me.data()};xe.status==="deleted"?o.push(xe):i.push(xe);const le=me.data();le.siteUrl&&(g[me.id]=le.siteUrl),le.deployedScripts&&Array.isArray(le.deployedScripts)&&(J[me.id]=le.deployedScripts)}),kt(i),Tt(o),_e(g),Ls(J)}catch(t){console.error("🚨 DATABASE ERROR in fetchApprovedUsers:"),console.error("🚨 Error Code:",t.code),console.error("🚨 Error Message:",t.message),console.error("🚨 Full Error Object:",t),console.error("🚨 Auth State:",d?"authenticated":"not authenticated"),kt([]),Tt([])}},Hs=async t=>{try{const s=doc(db,"usage",t);await updateDoc(s,{status:"deleted",deletedAt:new Date,updatedAt:new Date}),await ie()}catch(s){console.error("🚨 Error deleting user:",s)}},Ws=async t=>{try{const s=K.find(o=>o.id===t);if(!s){console.error("🚨 Deleted user not found");return}const r=ue[s.subscriptionTier]||0,i=doc(db,"usage",t);await updateDoc(i,{status:"approved",comparisonsLimit:r,restoredAt:new Date,updatedAt:new Date}),await ie()}catch(s){console.error("🚨 Error restoring user:",s)}},Js=async t=>{try{if(!K.find(i=>i.id===t)){console.error("🚨 User not found in deleted users");return}const r=doc(db,"usage",t);await deleteDoc(r),_e(i=>{const o={...i};return delete o[t],o}),await ie()}catch(s){console.error("🚨 Error permanently deleting user:",s)}};a.useEffect(()=>{const t=d,s=v;t&&!s?(console.log("🔒 User authenticated (or bypassed), loading data..."),Ke(!0),Promise.all([_s(),qe(),Pe(),ie()]).finally(()=>{Ke(!1)})):!t&&!s&&(console.log("🔒 User not authenticated"),Ke(!1)),window.addEventListener("error",r=>{console.error("🚨 UNHANDLED ERROR:",r.error),console.error("🚨 ERROR DETAILS:",{message:r.error?.message,stack:r.error?.stack,filename:r.filename,lineno:r.lineno})}),window.addEventListener("unhandledrejection",r=>{console.error("🚨 UNHANDLED PROMISE REJECTION:",r.reason),console.error("🚨 REJECTION DETAILS:",{reason:r.reason,promise:r.promise})})},[d,v,b,y]),a.useEffect(()=>{c==="script-testing"?(console.log("🔧 Script testing tab activated, initializing environment..."),pr()):Z("initializing")},[c,se,re]);const Gs=async(t,s)=>{try{const r=H.find(g=>g.id===t);if(!r){console.error("🚨 Pending user not found");return}if(!r.consultationCompleted||!r.scriptReady)throw new Error("User must complete consultation and have script ready before moving to testing.");const i=doc(db,"ready-for-testing",t);await setDoc(i,{...s,readyForTestingAt:new Date().toISOString(),qaStatus:"pending",websiteProvisioned:!1,scriptDeployed:!1});const o=doc(db,"pendingUsers",t);await deleteDoc(o),await Pe(),await qe(),Ge(t,"success",`${r.email} moved to testing phase. Create their website to begin QA testing.`)}catch(r){console.error("Error moving user to testing:",r),Ge(t,"error","Failed to move user to testing phase. Please try again.")}},qs=async(t,s)=>{try{const{consultationCompleted:r,scriptReady:i,consultationNotes:o,...g}=s,D={...g,updatedAt:new Date().toISOString()},{error:J}=await ce.from("pendingUsers").update(D).eq("id",t);if(J)throw J;Ze(me=>me.map(xe=>xe.id===t?{...xe,...s,updatedAt:new Date().toISOString()}:xe)),console.log("✅ Pending user updated successfully:",{userId:t,updates:s})}catch(r){console.error("Error updating pending user:",r),B("error","Update Failed","Failed to update user status")}},Ys=async t=>{try{const s=doc(db,"pendingUsers",t),r=doc(db,"usage",t);await deleteDoc(s),await deleteDoc(r),await qe()}catch(s){console.error("Error rejecting user:",s)}},Qs=async t=>{try{const s=doc(db,"usage",t);await updateDoc(s,{status:"deactivated",comparisonsLimit:0,deactivatedAt:new Date,updatedAt:new Date}),await ie()}catch(s){console.error("Error deactivating user:",s)}},Xs=async t=>{try{const s=ne.find(o=>o.id===t);if(!s){console.error("User not found");return}const r=ue[s.subscriptionTier]||0,i=doc(db,"usage",t);await updateDoc(i,{status:"approved",comparisonsLimit:r,reactivatedAt:new Date,updatedAt:new Date}),await ie()}catch(s){console.error("Error reactivating user:",s)}},Zs=(t,s)=>{Le("Temporarily Deactivate User",`Are you sure you want to deactivate ${s}?

This will:
• Remove their access to all services
• Set their usage limit to 0
• Keep their account data intact

Benefits:
• User can be reactivated later
• No data loss occurs
• Preserves user history and settings`,"Deactivate User","bg-orange-600 text-white",()=>Qs(t))},Ks=(t,s)=>{Le("Reactivate User Account",`Are you sure you want to reactivate the account for ${s}?

This will:
• Restore full access to their subscription
• Re-enable their comparison limits
• Allow them to use the platform again

Result:
• User will regain access immediately
• All previous data will be restored
• Usage limits will be reset to subscription tier`,"Reactivate User","bg-green-600 hover:bg-green-700",()=>Xs(t))},er=(t,s)=>{Le("Delete User Account",`Are you sure you want to delete the account for ${s}?

This will:
• Move user to "Deleted" tab
• Preserve all data for recovery
• Remove access to platform
• Keep Netlify site intact

Important:
• This is a soft delete - user can be restored later
• Use "Delete Website" first if you want to remove their site
• User data is preserved for compliance`,"Delete User","bg-red-600 hover:bg-red-700",()=>Hs(t))},tr=t=>{const r=K.find(i=>i.id===t)?.email||"Unknown";Le("Restore User Account",`Are you sure you want to restore the account for ${r}?

This will:
• Move user back to "Approved" tab
• Restore full subscription access
• Re-enable comparison limits based on tier
• Allow platform access immediately

Result:
• User will regain access immediately
• All data and settings will be restored
• Usage history will be preserved`,"Restore User","bg-green-600 hover:bg-green-700",()=>Ws(t))},sr=t=>{const r=K.find(o=>o.id===t)?.email||"Unknown",i=ee[t]?"YES":"NO";Le("PERMANENT DELETION - IRREVERSIBLE",`Are you sure you want to permanently delete ALL data for ${r}?

This will COMPLETELY REMOVE:
                • User account from database
• Netlify website and all deployed scripts (${i} site found)
• All user data and history
• All admin notes and records

WARNING:
• THIS ACTION IS 100% IRREVERSIBLE
• User will be completely erased from all systems
• No recovery will be possible
• Consider data retention compliance requirements`,"DELETE EVERYTHING","bg-red-600 hover:bg-red-700",()=>Js(t))},rr=t=>{ct(t),Se({businessName:t.businessName||"",businessType:t.businessType||"",subscriptionTier:t.subscriptionTier||"professional",billingCycle:t.billingCycle||"monthly",adminNotes:t.adminNotes||""}),ot(!0)},ar=async()=>{if(He)try{const t=doc(db,"usage",He.id),s=ue[z.subscriptionTier]||0;await updateDoc(t,{businessName:z.businessName,businessType:z.businessType,subscriptionTier:z.subscriptionTier,billingCycle:z.billingCycle,comparisonsLimit:s,adminNotes:z.adminNotes,updatedAt:new Date}),ot(!1),ct(null),await ie()}catch(t){console.error("Error updating user:",t)}},nr=async()=>{try{if(!S.email||!S.businessName||!S.businessType){console.error("🚨 Missing required fields"),B("error","Missing Information","Please fill in all required fields: Email, Business Name, and Business Type");return}const t=`admin_${Date.now()}`,s=ue[S.subscriptionTier]||0,r={email:S.email,businessName:S.businessName,businessType:S.businessType,subscriptionTier:S.subscriptionTier,billingCycle:S.billingCycle,comparisonsUsed:0,comparisonsLimit:s,status:"approved",createdAt:new Date,approvedAt:new Date,updatedAt:new Date,createdBy:"admin"};await setDoc(doc(db,"usage",t),r),$e(!1),we({email:"",businessName:"",businessType:"",subscriptionTier:"professional",billingCycle:"monthly"}),await ie()}catch(t){console.error("🚨 ERROR adding client:",t),console.error("🚨 Error details:",{code:t.code,message:t.message,stack:t.stack}),B("error","Failed to Add Client",`Error adding client: ${t.message||"Unknown error"}`)}},ir=async()=>{try{Me(!1),tt({name:"",file:null,clientId:""})}catch(t){console.error("Error uploading script:",t)}},Le=(t,s,r,i,o)=>{Dt({isOpen:!0,title:t,message:s,confirmText:r,confirmStyle:i,onConfirm:o})},rs=()=>{Dt({isOpen:!1,title:"",message:"",confirmText:"",confirmStyle:"",onConfirm:()=>{}})},lr=async t=>{t.preventDefault(),Ut(!0),at("");try{const{error:s}=await signIn(ze.email,ze.password);s?(console.error("🚨 Login error:",s),at(s.message||"Login failed")):st({email:"",password:""})}catch(s){console.error("🚨 Login error:",s),at(s.message||"Login failed")}finally{Ut(!1)}},or=async()=>{Ft("Email updates are currently disabled during Supabase migration. Please contact support for account changes.")},cr=async()=>{Ft("Password updates are currently disabled during Supabase migration. Please contact support for account changes.")},dr=async t=>{if(ee[t.id]){B("warning","Website Already Exists",`Website already provisioned for ${t.businessName||t.email}: ${ee[t.id]}`);return}Ot(s=>({...s,[t.id]:!0})),console.log("🚀 Starting provisioning for user:",{userId:t.id,businessName:t.businessName,email:t.email});try{const s=t.businessName||t.email||t.id,r=s.toLowerCase().replace(/[^a-z0-9]/g,"")||t.id;if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){console.log("🧪 Development mode - using mock provisioning"),await new Promise(D=>setTimeout(D,2e3));const o=`https://mock-${r}.netlify.app`;console.log("✅ Mock provisioning successful:",{siteUrl:o}),_e(D=>({...D,[t.id]:o}));const g=doc(db,"usage",t.id);await updateDoc(g,{siteUrl:o,clientPath:r,websiteCreated:!0,updatedAt:new Date}),Ge(t.id,"success",`Mock website created: ${o}`)}else{const o=s?.toLowerCase().replace(/[^a-z0-9]/g,"")||t.email?.split("@")[0]?.toLowerCase().replace(/[^a-z0-9]/g,"")||"client",g=`https://grbalance.netlify.app/${o}`;_e(J=>({...J,[t.id]:g}));const D=doc(db,"usage",t.id);await updateDoc(D,{siteUrl:g,clientPath:o,websiteCreated:!0,updatedAt:new Date}),Ge(t.id,"success",`Client access created: ${g} (Ready immediately)`)}}catch(s){console.error("❌ Provisioning error:",s);const r=s.response?.data;let i="Provisioning failed: ";r?.error?i+=r.error:r?.message?i+=r.message:i+=s.message||JSON.stringify(r)||"Unknown error";const o=s.response?.status||"Unknown";B("error",`Provisioning Failed (${o})`,i),console.error("Provisioning error details:",{status:s.response?.status,statusText:s.response?.statusText,data:s.response?.data,message:s.message,full:s})}finally{Ot(s=>({...s,[t.id]:!1}))}},mr=async()=>{if(console.log("🚀 Running test script..."),console.log("📊 File1Data length:",se.length),console.log("📊 File2Data length:",re.length),console.log("📄 testScript:",de?`${de.length} chars`:"null"),console.log("📄 testScriptText:",te?`${te.length} chars`:"null"),console.log("📄 scriptInputMethod:",Te),se.length===0){console.warn("❌ No file1Data - script cannot run");return}const t=de||te;if(console.log("📄 Final scriptContent:",t?`${t.length} chars`:"null"),!t||t.trim().length===0){console.warn("❌ No script content - script cannot run");return}try{bt(!0),window.parseFiles=()=>Promise.resolve({data1:se,data2:re.length>0?re:null}),window.findColumn=(r,i)=>{if(!r)return null;const o=Object.keys(r);return i.find(g=>o.some(D=>D.toLowerCase().includes(g.toLowerCase())||g.toLowerCase().includes(D.toLowerCase())))||i.find(g=>o.includes(g))||null},window.showResults=(r,i)=>{console.log("📊 Script Results:",r),Ue({success:!0,data:r,timestamp:new Date().toISOString(),rowsProcessed:se.length+(re.length||0),title:i?.title,summary:i?.summary});const o=(J,me,xe)=>{console.log("🔧 createResultsHTML called with:",J.length,"results");const le=J.length>0?Object.keys(J[0]):[],os=`
            <div style="padding: 16px; background-color: #fff;">
              <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; border: 1px solid #666;">
                  <thead>
                    <tr>
                      ${le.map((Fe,cs)=>`
                        <th style="padding: 12px; text-align: left; border-top: 1px solid #666; border-bottom: 1px solid #666; font-weight: bold; background-color: #f8f8f8; position: relative;">
                          ${Fe}
                          ${cs<le.length-1?'<div style="position: absolute; top: 0; right: -1px; width: 1px; height: 100%; background-color: #666; z-index: 100;"></div>':""}
                        </th>
                      `).join("")}
                    </tr>
                  </thead>
                  <tbody>
                    ${J.slice(0,5).map((Fe,cs)=>`
                      <tr>
                        ${le.map(yt=>`<td style="padding: 12px; border: 1px solid #666;">${Fe[yt]||Fe[yt]===0?Fe[yt]:"0"}</td>`).join("")}
                      </tr>
                    `).join("")}
                  </tbody>
                </table>
              </div>
              
              <div style="margin-top: 16px; color: #666; font-size: 14px;">
                ${Math.min(J.length,5)} of ${J.length} rows displayed${J.length>5?" (showing first 5)":""}
              </div>
            </div>
          `;return console.log("🔧 Generated HTML:",os.substring(0,200)+"..."),os},g=document.getElementById("script-results-display");g&&(g.innerHTML=o(r,i?.title,i?.summary));const D=document.getElementById("client-results-replica");D&&(D.innerHTML=o(r,i?.title,i?.summary))},window.showError=r=>{console.error("❌ Script Error:",r),Ue({success:!1,error:r,timestamp:new Date().toISOString(),rowsProcessed:0})},new Function(t)(),console.log("✅ Script execution completed")}catch(s){console.error("❌ Script execution error:",s),Ue({success:!1,error:s.message,timestamp:new Date().toISOString(),rowsProcessed:0})}finally{bt(!1)}},xr=()=>{console.log("🧹 Clearing all results..."),Ue(null),Zt([]),Kt([]),es(""),ts(""),mt([]),xt([]),pt(""),Je(""),gt(""),Yt(""),Xt(""),Gt(!1),bt(!1),$s(!1),console.log("✅ All results and data cleared successfully")},ur=async()=>{if(console.log("📊 Downloading script results to Excel..."),!X||!X.success){B("error","No Results","Please run a script first to generate results");return}try{B("info","Generating Excel","Creating Excel file...");const t=await Ye(()=>import("./xlsx-BBMPxr6S.js"),[]);let s=[];Array.isArray(X.data)?s=X.data:X.data&&X.data.results?s=X.data.results:typeof X.data=="object"?s=[X.data]:s=[{"Script Result":X.data||"Script completed successfully",Timestamp:X.timestamp,"Rows Processed":X.rowsProcessed}];const r=t.utils.book_new(),i=t.utils.json_to_sheet(s);t.utils.book_append_sheet(r,i,"Script Results");const g=`script-results-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}.xlsx`;t.writeFile(r,g),console.log("✅ Excel file generated and downloaded:",g)}catch(t){console.error("❌ Excel download error:",t),B("error","Export Failed",t.message||"Failed to generate Excel file")}},pr=()=>{console.log("🔧 Initializing test environment..."),Z("ready"),console.log("🎉 Library status updated to ready in React state!");const t=()=>{const s=document.getElementById("library-status");console.log("🔍 Looking for library-status element:",s),s?(console.log("✅ Found library-status element, updating..."),s.innerHTML='<p class="text-sm text-green-700">✅ Libraries ready and loaded!</p>',s.className="mb-6 p-4 bg-green-50 border border-green-200 rounded-md",console.log("🎉 Status updated to green successfully via DOM!")):(console.warn("⚠️ library-status element not found, retrying..."),setTimeout(t,200))};t(),setTimeout(t,100),setTimeout(t,500)},ft=t=>new Date(t),as=t=>{const s=new Date;if(!t)return 0;const r=typeof t=="string"?new Date(t):t;if(!r||typeof r.getTime!="function"||isNaN(r.getTime()))return 0;const i=s.getTime()-r.getTime();return Math.floor(i/(1e3*60*60*24))},gr=async(t,s)=>{console.log("🗑️ Deleting script:",s,"for user:",t)},hr=t=>dr(t),ns=async(t,s)=>{if(console.log(`📁 Testing file ${t} upload START:`,s.name,s.size,"bytes"),console.log("📋 File type:",s.type,"Last modified:",new Date(s.lastModified)),!s){console.warn("⚠️ No file provided to handleTestFileUpload");return}try{console.log(`🔍 Starting validation for file ${t}...`);const{validateFile:r}=await Ye(async()=>{const{validateFile:g}=await import("./fileValidator-BKWzj5g2.js");return{validateFile:g}},__vite__mapDeps([0,1]));console.log("✅ File validator imported successfully");const i=await r(s);if(console.log(`📋 File ${t} validation result:`,i),!i.isValid){const g=i.securityWarning?`🚨 SECURITY: ${i.error} - ${i.securityWarning}`:i.error||"File validation failed";console.error(`❌ File ${t} validation failed:`,g);return}console.log(`🔄 Parsing file ${t}...`),console.log("📦 About to call parseFile function...");const o=await Mr(s);console.log("📊 ParseFile returned:",o),console.log(`✅ File ${t} parsed successfully:`,o.rows.length,"rows"),t===1?(console.log("🔄 Setting file1Data..."),Zt(o.rows),es(s.name),console.log("📊 File 1 data updated in state")):t===2&&(console.log("🔄 Setting file2Data..."),Kt(o.rows),ts(s.name),console.log("📊 File 2 data updated in state")),console.log(`🎉 File ${t} upload process COMPLETED successfully!`)}catch(r){console.error(`❌ File ${t} upload error:`,r),console.error("❌ Error stack:",r.stack),console.error("❌ Error details:",{name:r.name,message:r.message,cause:r.cause})}},br=async t=>{if(console.log("📄 Testing script upload START:",t.name),!t){console.warn("⚠️ No script file provided");return}try{const s=new FileReader;s.onload=r=>{const i=r.target?.result;console.log("📄 Script file content loaded:",i.substring(0,100)+"..."),Ps(o=>({...o,scriptContent:i})),he(o=>({...o,scriptName:t.name.replace(".js",""),scriptContent:i})),pt(i),gt(t.name),ht("upload"),console.log("✅ Script upload completed successfully")},s.onerror=r=>{console.error("❌ Script file read error:",r)},s.readAsText(t)}catch(s){console.error("❌ Script upload error:",s)}},is=async t=>{console.log("🚀 Deploying script for user:",t.email)},fr=()=>{const t=Te==="paste"?te:de;if(!t.trim()){console.warn("No script to save");return}const r=`reconciliation-script-${new Date().toISOString().replace(/[:.]/g,"-")}.js`,i=new Blob([t],{type:"application/javascript"}),o=URL.createObjectURL(i),g=document.createElement("a");g.href=o,g.download=r,g.click(),URL.revokeObjectURL(o),console.log(`💾 Script saved as ${r}`)},yr=()=>{console.log("📋 Clearing script execution history...");const t=document.getElementById("script-results-display"),s=document.getElementById("client-results-replica");t&&(t.innerHTML=`
        <div class="text-center text-gray-500 py-8">
          Run your script to see results here...
        </div>
      `),s&&(s.innerHTML=`
        <div class="text-center text-gray-500 py-8">
          Execute script to see client-side results here...
        </div>
      `),Ue(null),console.log("✅ Script execution history cleared")};if(v)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Checking authentication..."})]})});if(m)return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center",children:e.jsx("div",{className:"bg-white p-8 rounded-xl shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-gray-700",children:"Verifying admin access..."})]})})});const be=d,ls=be?.email==="davisricart@gmail.com"&&(window.location.hostname==="localhost"||window.location.port==="3000")||b;if(ls)console.log("🚨 EMERGENCY ADMIN BYPASS ACTIVATED for:",be?.email||"localhost-test");else if(be&&!l&&!ls)return console.warn("🚨 SECURITY ALERT: Unauthorized admin access attempt by:",be.email),console.warn("🚨 User UID:",be.id),console.warn("🚨 Timestamp:",new Date().toISOString()),e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white",children:[e.jsx("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("a",{href:"/",className:"flex items-center gap-2 text-red-600 hover:text-red-700 transition-colors duration-200",children:[e.jsx(xs,{className:"h-5 w-5"}),"Back to Home"]})})})}),e.jsx("main",{className:"flex items-center justify-center px-4 py-12",children:e.jsxs("div",{className:"bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-md border-2 border-red-200",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-3 mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(us,{className:"h-8 w-8 text-red-600"})}),e.jsx("h2",{className:"text-red-700 text-center text-lg font-medium",children:"Access Denied"})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:"You are not authorized to access the admin dashboard."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Current user: ",e.jsx("span",{className:"font-medium",children:be.email})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"If you believe this is an error, please contact the system administrator."}),x&&e.jsxs("p",{className:"text-sm text-red-600",children:["Error: ",x]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:()=>ce.auth.signOut(),className:"w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2.5 px-4 rounded-lg transition duration-200",children:"Sign Out"})})]})]})})]});return!be&&!b?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white",children:[e.jsx("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("a",{href:"/",className:"flex items-center gap-2 text-emerald-600 hover:text-emerald-700 transition-colors duration-200",children:[e.jsx(xs,{className:"h-5 w-5"}),"Back to Home"]})})})}),e.jsx("main",{className:"flex items-center justify-center px-4 py-12",children:e.jsxs("div",{className:"bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-3 mb-6",children:[e.jsx("img",{src:ps.logo,alt:`${ps.title} Logo`,className:"h-28 sm:h-32 w-auto object-contain"}),e.jsx("h2",{className:"text-emerald-700 text-center text-base sm:text-lg font-medium",children:"Admin Login"})]}),e.jsxs("form",{onSubmit:lr,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-emerald-600 mb-1.5",children:"Email"}),e.jsx("input",{type:"email",value:ze.email,onChange:t=>st(s=>({...s,email:t.target.value})),className:"w-full px-3 py-2.5 rounded-lg border border-emerald-100 focus:ring-2 focus:ring-emerald-400/50 focus:border-transparent transition duration-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-emerald-600 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:rt?"text":"password",value:ze.password,onChange:t=>st(s=>({...s,password:t.target.value})),className:"w-full px-3 py-2.5 rounded-lg border border-emerald-100 focus:ring-2 focus:ring-emerald-400/50 focus:border-transparent transition duration-200",required:!0}),e.jsx("button",{type:"button",onClick:()=>Es(!rt),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-emerald-600 transition-colors",children:rt?e.jsx(Ie,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})})]})]}),Pt&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-red-700 text-sm",children:Pt})]})}),e.jsx("button",{type:"submit",disabled:Rt,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-2.5 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:Rt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"h-4 w-4"}),"Access Admin Dashboard"]})})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage clients and user approvals"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Welcome, ",d.email]}),e.jsx("button",{onClick:()=>ce.auth.signOut(),className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors",children:"Sign Out"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-100 p-1",children:e.jsxs("nav",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>f("clients"),className:`flex-1 py-3 px-4 text-xs font-medium uppercase tracking-wide transition-all duration-200 rounded-md ${c==="clients"?"bg-white text-green-600 shadow-sm border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx(ye,{className:"inline w-4 h-4 mr-2"}),"CLIENTS",c!=="clients"&&w.length>0&&e.jsx("span",{className:"ml-2 bg-gray-500 text-white px-2 py-1 rounded-full text-xs",children:w.length}),c==="clients"&&w.length>0&&e.jsx("span",{className:"ml-2 bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs",children:w.length})]}),e.jsxs("button",{onClick:()=>f("pending"),className:`flex-1 py-3 px-4 text-xs font-medium uppercase tracking-wide transition-all duration-200 rounded-md ${c==="pending"?"bg-white text-green-600 shadow-sm border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx(je,{className:"inline w-4 h-4 mr-2"}),"PENDING",c!=="pending"&&H.length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs animate-pulse",children:H.length}),c==="pending"&&H.length>0&&e.jsx("span",{className:"ml-2 bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs",children:H.length})]}),e.jsxs("button",{onClick:()=>f("ready-for-testing"),className:`flex-1 py-3 px-4 text-xs font-medium uppercase tracking-wide transition-all duration-200 rounded-md ${c==="ready-for-testing"?"bg-white text-green-600 shadow-sm border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx(Ee,{className:"inline w-4 h-4 mr-2"}),"QA TESTING",c!=="ready-for-testing"&&ge.length>0&&e.jsx("span",{className:"ml-2 bg-blue-500 text-white px-2 py-1 rounded-full text-xs",children:ge.length}),c==="ready-for-testing"&&ge.length>0&&e.jsx("span",{className:"ml-2 bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs",children:ge.length})]}),e.jsxs("button",{onClick:()=>f("approved"),className:`flex-1 py-3 px-4 text-xs font-medium uppercase tracking-wide transition-all duration-200 rounded-md ${c==="approved"?"bg-white text-green-600 shadow-sm border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx(Nt,{className:"inline w-4 h-4 mr-2"}),"APPROVED",c!=="approved"&&ne.length>0&&e.jsx("span",{className:"ml-2 bg-blue-500 text-white px-2 py-1 rounded-full text-xs",children:ne.length}),c==="approved"&&ne.length>0&&e.jsx("span",{className:"ml-2 bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs",children:ne.length})]}),e.jsxs("button",{onClick:()=>f("deleted"),className:`flex-1 py-3 px-4 text-xs font-medium uppercase tracking-wide transition-all duration-200 rounded-md ${c==="deleted"?"bg-white text-green-600 shadow-sm border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx(vt,{className:"inline w-4 h-4 mr-2"}),"DELETED",c!=="deleted"&&K.length>0&&e.jsx("span",{className:"ml-2 bg-orange-500 text-white px-2 py-1 rounded-full text-xs",children:K.length}),c==="deleted"&&K.length>0&&e.jsx("span",{className:"ml-2 bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs",children:K.length})]}),e.jsxs("button",{onClick:()=>f("settings"),className:`flex-1 py-3 px-4 text-xs font-medium uppercase tracking-wide transition-all duration-200 rounded-md ${c==="settings"?"bg-white text-green-600 shadow-sm border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx(je,{className:"inline w-4 h-4 mr-2"}),"SETTINGS"]}),e.jsxs("button",{onClick:()=>f("script-testing"),className:`flex-1 py-3 px-4 text-xs font-medium uppercase tracking-wide transition-all duration-200 rounded-md ${c==="script-testing"?"bg-white text-green-600 shadow-sm border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx(Ir,{className:"inline w-4 h-4 mr-2"}),"SCRIPT TESTING"]})]})})}),c==="clients"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{onClick:()=>$e(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center transition-colors",children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Add Client"]}),e.jsxs("button",{onClick:()=>Me(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center transition-colors",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Upload Script"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Active Clients"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Manage your client accounts and their configurations"})]}),w.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:e.jsx(ye,{className:"h-12 w-12"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No clients"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by adding your first client."}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>$e(!0),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Add Client"]})})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300",children:"Client Information"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300",children:"Configuration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300",children:"Scripts"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(ye,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",t.id]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap border-b border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Registered: ",ft(t.createdAt)?.toLocaleDateString()||"N/A"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap border-b border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:["Subdomain: ",t.subdomain]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.scripts?.length||0," scripts"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap border-b border-gray-200",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 border-b border-gray-200",children:t.scripts?.length>0?e.jsxs("div",{className:"space-y-1",children:[t.scripts.slice(0,2).map((s,r)=>e.jsx("div",{className:"text-xs bg-gray-100 rounded px-2 py-1",children:s},r)),t.scripts.length>2&&e.jsxs("div",{className:"text-xs text-gray-400",children:["+",t.scripts.length-2," more"]})]}):e.jsx("span",{className:"text-gray-400",children:"No scripts"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{At(t.id),Me(!0)},className:"text-blue-600 hover:text-blue-900 bg-blue-50 hover:bg-blue-100 px-2 py-1 rounded text-xs",children:"Upload Script"}),e.jsx("button",{className:"text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 px-2 py-1 rounded text-xs",children:e.jsx(vt,{className:"w-3 h-3 inline"})})]})]},t.id))})]})})]})]}),c==="pending"&&e.jsx(zr,{pendingUsers:H,onMoveToTesting:Gs,onRejectUser:async(t,s)=>{await Ys(t)},onUpdatePendingUser:qs,isLoading:Et}),c==="ready-for-testing"&&e.jsx(Br,{readyForTestingUsers:ge,onFinalApprove:async(t,s)=>{console.log("🚀 onFinalApprove called with userId:",t,"userData:",s);try{const r=ge.find(D=>D.id===t);if(console.log("📋 Found readyUser:",r),!r){console.error("❌ Ready user not found for userId:",t),B("error","Error","User not found in ready for testing list");return}const i={...s,id:t,email:r.email,businessName:r.businessName,businessType:r.businessType,subscriptionTier:r.subscriptionTier,billingCycle:r.billingCycle,createdAt:r.createdAt,siteUrl:r.siteUrl||null,siteName:r.siteName||null,consultationCompleted:r.consultationCompleted??!0,scriptReady:r.scriptReady??!0,consultationNotes:r.consultationNotes||"",qaPassedAt:new Date().toISOString(),approvedAt:new Date().toISOString(),status:"approved"};console.log("🎯 Final approval - transferring data:",i),console.log("💾 Writing to usage collection...");const o=doc(db,"usage",t);await setDoc(o,i),console.log("✅ Successfully wrote to usage collection"),console.log("🗑️ Removing from ready-for-testing collection...");const g=doc(db,"ready-for-testing",t);await deleteDoc(g),console.log("✅ Successfully removed from ready-for-testing"),console.log("🔄 Refreshing data..."),await Pe(),await ie(),console.log("✅ Data refresh completed"),console.log("✅ User approved successfully:",r.email)}catch(r){throw console.error("❌ Error in onFinalApprove:",r),r}},onSendBackToPending:async(t,s)=>{console.log("🔄 sendBackToPending called with:",{userId:t,reason:s});const r=ge.find(i=>i.id===t);if(console.log("📋 Found readyUser:",r),r){const i={id:t,email:r.email,businessName:r.businessName,businessType:r.businessType,subscriptionTier:r.subscriptionTier,billingCycle:r.billingCycle,createdAt:r.createdAt,status:"pending",consultationCompleted:!1,scriptReady:!1,consultationNotes:s?`Sent back from testing: ${s}`:"Sent back from testing",updatedAt:new Date().toISOString()};console.log("💾 Preparing to save pendingUserData:",i);try{const o=doc(db,"pendingUsers",t);console.log("📝 Writing to pendingUsers collection..."),await setDoc(o,i),console.log("✅ Successfully wrote to pendingUsers");const g=doc(db,"ready-for-testing",t);console.log("🗑️ Removing from ready-for-testing collection..."),await deleteDoc(g),console.log("✅ Successfully removed from ready-for-testing"),console.log("🔄 Refreshing data..."),await Pe(),await qe(),console.log("✅ Data refresh completed")}catch(o){console.error("❌ Error in sendBackToPending:",o),B("error","Error",`Failed to send user back to pending: ${o.message}`)}}else console.error("❌ Ready user not found for userId:",t),B("error","Error","User not found in ready for testing list")},onUpdateTestingUser:async(t,s)=>{const r=doc(db,"ready-for-testing",t);await updateDoc(r,{...s,updatedAt:new Date().toISOString()}),await Pe()},isLoading:Et}),c==="approved"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Users"}),e.jsx("input",{type:"text",placeholder:"Search by email, business name, or ID...",value:C,onChange:t=>V(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:Ds,onChange:t=>Mt(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"deactivated",children:"Deactivated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subscription"}),e.jsxs("select",{value:Rs,onChange:t=>zt(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Tiers"}),e.jsx("option",{value:"starter",children:"Starter"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"business",children:"Business"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{V(""),Mt("all"),zt("all")},className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50",children:"Clear Filters"})})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Showing ",ss.length," of ",ne.length," users"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Approved Users"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Manage approved user accounts"})]}),ne.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:e.jsx(je,{className:"h-12 w-12"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No approved users"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"All approved users have been processed."}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"text-xs text-gray-400",children:"Approved users will appear here for admin review"})})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:ss.map(t=>e.jsxs("div",{className:"p-6 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center flex-shrink-0 ${t.status==="approved"?"bg-green-100":"bg-gray-100"}`,children:t.status==="approved"?e.jsx(Nt,{className:"h-5 w-5 text-green-600"}):e.jsx(wt,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",t.id]}),t.status==="deactivated"&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"⚠️ Account Deactivated"})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.subscriptionTier}),t.status==="deactivated"&&e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Deactivated"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase tracking-wide font-medium",children:"Business"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"text-gray-900",children:t.businessName||"N/A"}),e.jsx("div",{className:"text-gray-500",children:t.businessType||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase tracking-wide font-medium",children:"Usage"}),e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{className:"text-gray-900",children:[t.comparisonsUsed||0,"/",t.comparisonsLimit," used"]}),e.jsxs("div",{className:"text-gray-500",children:["$",t.subscriptionTier==="starter"?"19":t.subscriptionTier==="professional"?"29":"49","/month"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase tracking-wide font-medium",children:"Registration"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"text-gray-900",children:ft(t.createdAt)?.toLocaleDateString()||"N/A"}),e.jsxs("div",{className:"text-gray-500",children:[as(t.createdAt)," days ago"]})]})]}),ee[t.id]&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase tracking-wide font-medium",children:"Site Status"}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-green-600 font-medium",children:"Provisioned"}),e.jsx("a",{href:ee[t.id],target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-xs underline",children:"View Site"})]})})]})]}),ee[t.id]&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"text-blue-700 text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Available Scripts (",We[t.id]?.length||0,")",e.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full",children:"What user sees on their website"})]}),e.jsx("div",{className:"space-y-2",children:We[t.id]&&We[t.id].length>0?We[t.id].map((s,r)=>{const i=typeof s=="string"?s:s.name,o=typeof s=="object"?s:null;return e.jsx("div",{className:"bg-white border border-blue-200 rounded-lg p-3 shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:i}),o?.status==="active"&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full",children:"Active"})]}),o&&e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Deployed: ",new Date(o.deployedAt).toLocaleString()]}),e.jsxs("div",{children:["Size: ",o.size," characters | Type: ",o.type]}),o.preview&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs font-mono text-gray-700 border-l-2 border-blue-400",children:[e.jsx("div",{className:"text-blue-600 font-semibold mb-1",children:"Script Preview:"}),o.preview]})]})]}),e.jsx("button",{onClick:g=>{g.preventDefault(),g.stopPropagation(),gr(t.id,i)},className:"ml-3 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full p-1 transition-all",title:`Remove ${i}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})},`${t.id}-${i}-${r}`)}):e.jsxs("div",{className:"text-center py-4 text-blue-600 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(Oe,{className:"w-8 h-8 mx-auto mb-2 text-blue-400"}),e.jsx("div",{className:"font-medium mb-1",children:"No scripts deployed yet"}),e.jsx("div",{className:"text-sm text-blue-500",children:'Use "Deploy Script" to add custom analysis scripts to their website'})]})})]}),t.adminNotes&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400",children:[e.jsx("div",{className:"text-xs text-yellow-700 font-medium mb-1",children:"ADMIN NOTES:"}),e.jsx("div",{className:"text-sm text-yellow-800",children:t.adminNotes})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.status==="approved"?e.jsxs(e.Fragment,{children:[ee[t.id]?e.jsxs("a",{href:ee[t.id],target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-emerald-700 transition-colors",children:[e.jsx(js,{className:"w-4 h-4"}),"Visit Site"]}):e.jsx("button",{type:"button",onClick:()=>hr(t),className:`inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${nt[t.id]?"bg-yellow-500 text-white cursor-not-allowed animate-pulse":"bg-emerald-600 text-white hover:bg-emerald-700"}`,disabled:nt[t.id],children:nt[t.id]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"w-4 h-4"}),"Create Site"]})}),ee[t.id]&&e.jsxs("button",{onClick:()=>{lt(t),it(!0)},className:"inline-flex items-center gap-1.5 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(je,{className:"w-4 h-4"}),"Deploy Script"]}),e.jsxs("button",{onClick:()=>rr(t),className:"inline-flex items-center gap-1.5 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit Details"]}),e.jsxs("button",{onClick:()=>Zs(t.id,t.email),className:"inline-flex items-center gap-1.5 bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-700 transition-colors",children:[e.jsx(wt,{className:"w-4 h-4"}),"Deactivate"]}),e.jsxs("button",{onClick:()=>er(t.id,t.email),className:"inline-flex items-center gap-1.5 bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-700 transition-colors",children:[e.jsx(vt,{className:"w-4 h-4"}),"Delete User"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-gray-100 text-gray-600 px-3 py-2 rounded-lg text-sm",children:[e.jsx(wt,{className:"w-4 h-4"}),"Account Deactivated"]}),e.jsxs("button",{type:"button",onClick:()=>Ks(t.id,t.email),className:"inline-flex items-center gap-2 bg-green-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-green-700",children:[e.jsx(Nt,{className:"w-4 h-4"}),"Reactivate"]})]})})]},t.id))})]})]}),c==="deleted"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Deleted Users"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Manage deleted user accounts"})]}),K.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:e.jsx(je,{className:"h-12 w-12"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No deleted users"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"All deleted users have been permanently removed."}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"text-xs text-gray-400",children:"Deleted users will appear here for admin review"})})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Information"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Business Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subscription Plan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usage Limit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Registration Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ye,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",t.id]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.businessName}),e.jsx("div",{className:"text-sm text-gray-500",children:t.businessType})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:t.subscriptionTier}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.billingCycle})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[ue[t.subscriptionTier]||"Unknown"," calls/month"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["$",t.subscriptionTier==="starter"?"29":t.subscriptionTier==="professional"?"79":"149","/month"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsx("div",{children:ft(t.createdAt)?.toLocaleDateString()||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[as(t.createdAt)," days ago"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>tr(t.id),className:"bg-green-600 text-white px-3 py-1.5 rounded text-sm hover:bg-green-700 transition-colors flex items-center",children:"✓ Restore"}),e.jsx("button",{onClick:()=>sr(t.id),className:"bg-red-600 text-white px-3 py-1.5 rounded text-sm hover:bg-red-700 transition-colors flex items-center mt-1",children:"✗ Permanent Delete"})]})]},t.id))})]})})]})}),!1,!1,c==="settings"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Account Settings"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Update your admin account email and password"})]}),e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Current Account"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Email: ",e.jsx("span",{className:"font-medium",children:d?.email||"Not available"})]})]}),It&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-green-600",children:It})}),Lt&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:Lt})}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Change Email Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password (required for verification)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:M.current?"text":"password",value:W.currentPassword,onChange:t=>Re({...W,currentPassword:t.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your current password"}),e.jsx("button",{type:"button",onClick:()=>Be({...M,current:!M.current}),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:M.current?e.jsx(Ie,{className:"h-5 w-5"}):e.jsx(oe,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Email Address"}),e.jsx("input",{type:"email",value:W.newEmail,onChange:t=>Re({...W,newEmail:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter new email address"})]}),e.jsx("button",{onClick:or,disabled:Ve||!W.currentPassword||!W.newEmail,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:Ve?"Updating...":"Update Email"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Change Password"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:M.current?"text":"password",value:W.currentPassword,onChange:t=>Re({...W,currentPassword:t.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your current password"}),e.jsx("button",{type:"button",onClick:()=>Be({...M,current:!M.current}),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:M.current?e.jsx(Ie,{className:"h-5 w-5"}):e.jsx(oe,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:M.new?"text":"password",value:W.newPassword,onChange:t=>Re({...W,newPassword:t.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter new password (min 6 characters)"}),e.jsx("button",{type:"button",onClick:()=>Be({...M,new:!M.new}),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:M.new?e.jsx(Ie,{className:"h-5 w-5"}):e.jsx(oe,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:M.confirm?"text":"password",value:W.confirmPassword,onChange:t=>Re({...W,confirmPassword:t.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Confirm new password"}),e.jsx("button",{type:"button",onClick:()=>Be({...M,confirm:!M.confirm}),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:M.confirm?e.jsx(Ie,{className:"h-5 w-5"}):e.jsx(oe,{className:"h-5 w-5"})})]})]}),e.jsx("button",{onClick:cr,disabled:Ve||!W.currentPassword||!W.newPassword||!W.confirmPassword,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:Ve?"Updating...":"Update Password"})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:[e.jsx("h5",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Security Notice"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• You'll need to enter your current password to make any changes"}),e.jsx("li",{children:"• Choose a strong password with at least 6 characters"}),e.jsx("li",{children:"• Email changes may require verification"}),e.jsx("li",{children:"• Keep your credentials secure and don't share them"})]})]})]})]})}),c==="script-testing"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Script Testing Environment"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Test your GR Balance scripts locally before deployment"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{id:"library-status",className:`mb-6 p-4 rounded-md ${P==="ready"?"bg-green-50 border border-green-200":"bg-blue-50 border border-blue-200"}`,children:e.jsx("p",{className:`text-sm ${P==="ready"?"text-green-700":"text-blue-700"}`,children:P==="ready"?"✅ Libraries ready and loaded!":"🔄 Initializing libraries..."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-green-100 text-green-600 rounded-full font-semibold text-sm",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Primary Dataset"}),e.jsx("p",{className:"text-xs text-green-600",children:"Main data source for analysis"})]})]}),e.jsxs("div",{id:"test-file1-dropzone",className:"relative border-2 border-dashed border-green-300 rounded-lg p-6 text-center hover:border-green-500 hover:bg-green-50 transition-colors cursor-pointer group",children:[e.jsx("input",{type:"file",id:"test-file1",accept:".xlsx,.xls,.csv",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:t=>{const s=t.target.files?.[0];s&&ns(1,s)}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-green-400 group-hover:text-green-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-green-600 font-medium group-hover:text-green-700",children:"Click to upload Excel or CSV"})}),e.jsx("p",{className:"text-xs text-green-500",children:"Primary data source"}),se.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-green-700 bg-green-100 px-2 py-1 rounded",children:["✅ ",zs]})]})]}),e.jsx("div",{id:"file1-validation",className:"text-sm"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-600 rounded-full font-semibold text-sm",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Secondary Dataset"}),e.jsx("p",{className:"text-xs text-blue-600",children:"Optional - for comparisons"})]})]}),e.jsxs("div",{id:"test-file2-dropzone",className:"relative border-2 border-dashed border-blue-300 rounded-lg p-6 text-center hover:border-blue-500 hover:bg-blue-50 transition-colors cursor-pointer group",children:[e.jsx("input",{type:"file",id:"test-file2",accept:".xlsx,.xls,.csv",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:t=>{const s=t.target.files?.[0];s&&ns(2,s)}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-blue-400 group-hover:text-blue-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-blue-600 font-medium group-hover:text-blue-700",children:"Click to upload Excel or CSV"})}),e.jsx("p",{className:"text-xs text-blue-500",children:"Optional comparison file"}),re.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-blue-700 bg-blue-100 px-2 py-1 rounded",children:["✅ ",Bs]})]})]}),e.jsx("div",{id:"file2-validation",className:"text-sm"})]})]}),(se.length>0||re.length>0)&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[se.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsxs("h4",{className:"text-sm font-medium text-gray-900",children:["Primary Dataset (",se.length," rows)"]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:[e.jsx("h5",{className:"text-xs font-medium text-green-800 mb-1",children:"Column Headers"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.keys(se[0]||{}).map((t,s)=>e.jsx("button",{onClick:()=>{const r=Ce.includes(t);mt(r?i=>i.filter(o=>o!==t):i=>[...i,t]),console.log(`🔄 Column "${t}" ${r?"deselected":"selected"} for File 1`)},className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${Ce.includes(t)?"bg-green-600 text-white":"bg-white text-green-700 border border-green-300 hover:bg-green-100"}`,children:t},`file1-${t}-${s}`))}),Ce.length>0&&e.jsxs("p",{className:"text-xs text-green-700 mt-2",children:["✅ ",Ce.length," column",Ce.length!==1?"s":""," selected: ",Ce.join(", ")]})]})]}),re.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsxs("h4",{className:"text-sm font-medium text-gray-900",children:["Secondary Dataset (",re.length," rows)"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsx("h5",{className:"text-xs font-medium text-blue-800 mb-1",children:"Column Headers"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.keys(re[0]||{}).map((t,s)=>e.jsx("button",{onClick:()=>{const r=ke.includes(t);xt(r?i=>i.filter(o=>o!==t):i=>[...i,t]),console.log(`🔄 Column "${t}" ${r?"deselected":"selected"} for File 2`)},className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${ke.includes(t)?"bg-blue-600 text-white":"bg-white text-blue-700 border border-blue-300 hover:bg-blue-100"}`,children:t},`file2-${t}-${s}`))}),ke.length>0&&e.jsxs("p",{className:"text-xs text-blue-700 mt-2",children:["✅ ",ke.length," column",ke.length!==1?"s":""," selected: ",ke.join(", ")]})]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Test Script"}),e.jsxs("div",{className:"flex mb-4 border-b border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>{ht("paste"),pt(""),gt("")},className:`px-4 py-2 -mb-px text-sm font-medium border-b-2 ${Te==="paste"?"text-blue-600 border-blue-600":"text-gray-500 border-transparent hover:text-gray-700"}`,children:"Copy & Paste"}),e.jsx("button",{type:"button",onClick:()=>{ht("upload"),Je("")},className:`px-4 py-2 -mb-px text-sm font-medium border-b-2 ${Te==="upload"?"text-blue-600 border-blue-600":"text-gray-500 border-transparent hover:text-gray-700"}`,children:"Upload File"})]}),Te==="paste"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"test-script-textarea",value:te,onChange:t=>{Je(t.target.value),t.target.value.trim().length>0&&(Yt(""),Xt(""),Gt(!1))},placeholder:"Paste your Claude-generated script here...",className:"w-full h-40 px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"}),te&&e.jsx("button",{type:"button",onClick:()=>Je(""),className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Paste your JavaScript reconciliation script here"}),te&&e.jsxs("p",{className:"text-xs text-green-600",children:["✓ Script ready (",te.length," characters)"]})]}),Te==="upload"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 hover:bg-blue-50 transition-colors cursor-pointer group",children:[e.jsx("input",{type:"file",id:"test-script-file",accept:".js",className:"hidden",onChange:t=>{const s=t.target.files?.[0];s&&br(s)}}),e.jsxs("label",{htmlFor:"test-script-file",className:"cursor-pointer flex flex-col items-center space-y-2",children:[e.jsx("svg",{className:"w-8 h-8 text-gray-400 group-hover:text-blue-500 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-blue-600 font-medium group-hover:text-blue-700",children:"Choose Script File"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"or drag and drop a .js file"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Upload a .js file containing your script"}),de&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3",children:[e.jsx("h5",{className:"font-medium text-green-900",children:"✓ Script Loaded"}),e.jsxs("p",{className:"text-sm text-green-700",children:[Jt&&e.jsx("strong",{children:Jt})," loaded successfully (",de.length," characters)"]})]})]})]}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("button",{id:"run-comparison-btn",onClick:mr,className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-all duration-200 text-sm shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:"🚀 Run Script"}),e.jsx("button",{id:"clear-results-btn",onClick:xr,className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 font-medium transition-all duration-200 text-sm shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",title:"Clear script execution output and results",children:"🔄 Reset Output"}),e.jsx("button",{id:"download-excel-btn",onClick:ur,className:"px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 font-medium transition-all duration-200 text-sm shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",title:"Download complete script results as Excel file for admin analysis",children:"📊 Download to Excel"})]}),Ms&&qt&&!Os&&!(de&&de.length>0)&&!(te&&te.length>0)&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg flex items-center space-x-2 text-sm animate-pulse ${Qt==="warning"?"bg-amber-50 border border-amber-200 text-amber-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[e.jsx("span",{className:"text-base",children:Qt==="warning"?"⚠️":"❌"}),e.jsx("span",{children:qt})]}),e.jsxs("div",{id:"results-section",className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Script Builder"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:fr,className:"px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 flex items-center space-x-1 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:[e.jsx("span",{children:"💾"}),e.jsx("span",{children:"Save Script"})]}),e.jsxs("button",{onClick:yr,className:"px-3 py-2 bg-slate-600 text-white text-sm rounded-md hover:bg-slate-700 flex items-center space-x-1 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5",title:"Clear step-by-step execution history display",children:[e.jsx("span",{children:"📋"}),e.jsx("span",{children:"Clear History"})]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg mb-6",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{id:"script-results-display",className:"min-h-[200px]",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Run your script to see results here..."})})})})]}),e.jsxs("div",{className:"rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Client View"}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg",children:e.jsx("div",{id:"client-results-replica",className:"p-6",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Execute script to see client-side results here..."})})})]})]})]})]})}),Cs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Add New Client"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",value:S.email,onChange:t=>we({...S,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"client@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name"}),e.jsx("input",{type:"text",value:S.businessName,onChange:t=>we({...S,businessName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter business name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Type"}),e.jsxs("select",{value:S.businessType,onChange:t=>we({...S,businessType:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select business type"}),e.jsx("option",{value:"restaurant",children:"Restaurant"}),e.jsx("option",{value:"retail",children:"Retail Store"}),e.jsx("option",{value:"franchise",children:"Franchise"}),e.jsx("option",{value:"grocery",children:"Grocery Store"}),e.jsx("option",{value:"salon",children:"Salon/Spa"}),e.jsx("option",{value:"automotive",children:"Automotive"}),e.jsx("option",{value:"healthcare",children:"Healthcare/Medical"}),e.jsx("option",{value:"fitness",children:"Fitness/Gym"}),e.jsx("option",{value:"service",children:"Service Business"}),e.jsx("option",{value:"ecommerce",children:"E-commerce"}),e.jsx("option",{value:"hospitality",children:"Hotel/Hospitality"}),e.jsx("option",{value:"entertainment",children:"Entertainment/Events"}),e.jsx("option",{value:"professional",children:"Professional Services"}),e.jsx("option",{value:"nonprofit",children:"Non-Profit"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subscription Tier"}),e.jsxs("select",{value:S.subscriptionTier,onChange:t=>we({...S,subscriptionTier:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"starter",children:["Starter - ",S.billingCycle==="annual"?"$15":"$19","/month",S.billingCycle==="annual"?" (Billed as $182/year)":""]}),e.jsxs("option",{value:"professional",children:["Professional - ",S.billingCycle==="annual"?"$27":"$34","/month",S.billingCycle==="annual"?" (Billed as $324/year)":""]}),e.jsxs("option",{value:"business",children:["Business - ",S.billingCycle==="annual"?"$47":"$59","/month",S.billingCycle==="annual"?" (Billed as $564/year)":""]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Cycle"}),e.jsxs("select",{value:S.billingCycle,onChange:t=>we({...S,billingCycle:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"annual",children:"Annual (Save 20%)"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>$e(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:nr,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Client"})]})]})}),ks&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Upload Script"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Script Name"}),e.jsx("input",{type:"text",value:et.name,onChange:t=>tt({...et,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter script name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Client"}),e.jsxs("select",{value:Ts,onChange:t=>At(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Choose a client..."}),w.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Script File"}),e.jsx("input",{type:"file",onChange:t=>tt({...et,file:t.target.files?.[0]||null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",accept:".js,.py,.php"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>Me(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:ir,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Upload"})]})]})}),Ne.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:Ne.title}),e.jsx("div",{className:"text-gray-700 mb-6 space-y-3",children:Ne.message.split(`

`).map((t,s)=>e.jsx("div",{children:t.split(`
`).map((r,i)=>r.startsWith("• ")?e.jsxs("div",{className:"flex items-start gap-2 ml-2",children:[e.jsx("span",{className:"text-emerald-600 font-bold text-sm mt-0.5",children:"•"}),e.jsx("span",{className:"text-sm",children:r.substring(2)})]},i):r.trim()===""?e.jsx("div",{className:"h-2"},i):e.jsx("div",{className:"text-sm leading-relaxed",children:r},i))},s))}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:rs,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>{Ne.onConfirm(),rs()},className:`px-4 py-2 ${Ne.confirmStyle} rounded-md hover:bg-opacity-90 transition-colors font-medium`,children:Ne.confirmText})]})]})}),As&&Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4",children:["Deploy Script for ",Q.businessName||Q.email]}),F.scriptContent&&G&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-green-800 font-medium text-sm",children:"Script Auto-Loaded from Testing"})]}),e.jsxs("div",{className:"text-green-700 text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Algorithm:"})," ",G.algorithm]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Description:"})," ",G.description]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Mapping:"})," ",G.columnMappings.file1Column," → ",G.columnMappings.file2Column]})]}),e.jsx("div",{className:"text-green-600 text-xs mt-2",children:"✅ Ready to deploy! The script content below has been automatically filled with your generated logic."})]}),e.jsxs("form",{noValidate:!0,onSubmit:t=>{t.preventDefault(),is(Q)},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Script Name"}),e.jsx("input",{type:"text",value:F.scriptName,onChange:t=>he({...F,scriptName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., reconciliation-script-v1.js",onKeyDown:t=>{t.key==="Enter"&&t.preventDefault()}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Script Content"}),F.scriptContent&&G&&e.jsx("span",{className:"text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full",children:"Auto-filled from testing"})]}),!F.scriptContent&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"file",accept:".js,.ts,.mjs",onChange:async t=>{const s=t.target.files?.[0];if(s){const{bulletproofValidateFile:r}=await Ye(async()=>{const{bulletproofValidateFile:g}=await import("./bulletproofFileValidator-byQ5H6Lu.js");return{bulletproofValidateFile:g}},__vite__mapDeps([2,1])),i=await r(s);if(!i.isValid){const g=i.securityWarning?`${i.error} ${i.securityWarning}`:i.error||"Invalid file. Please upload a valid JavaScript or TypeScript file.";dt(g),t.target.value="",setTimeout(()=>dt(""),1e4);return}dt("");const o=new FileReader;o.onload=g=>{const D=g.target?.result;he({...F,scriptContent:D,scriptName:F.scriptName||s.name})},o.readAsText(s)}},className:"hidden",id:"script-file-upload"}),e.jsxs("label",{htmlFor:"script-file-upload",className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Upload Script File"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"or paste/write code below"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Supports .js, .ts, .mjs files. File content will populate the editor below."}),Bt&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 mt-3 text-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-red-600 text-lg flex-shrink-0",children:"🚫"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-red-800 mb-2",children:"File Upload Error"}),e.jsx("div",{className:"text-red-700 mb-3",children:Bt}),e.jsxs("div",{className:"text-red-600 text-xs",children:[e.jsx("strong",{children:"Accepted file types:"})," JavaScript (.js), TypeScript (.ts), or Module (.mjs) files only"]})]})]})})]}),e.jsx("textarea",{value:F.scriptContent,onChange:t=>he({...F,scriptContent:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",rows:15,placeholder:F.scriptContent?"Script content loaded automatically...":`// Upload a file above or enter your JavaScript code here
function reconcileData() {
  // Your custom reconciliation logic
  console.log('Reconciliation script running...');
}

// Example usage
reconcileData();`,onKeyDown:t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&t.preventDefault()}}),!G&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>he({...F,scriptContent:""}),className:"text-xs px-2 py-1 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Clear"}),e.jsx("button",{type:"button",onClick:()=>{const t=`// ${F.scriptName||"Custom Script"}
// Generated: ${new Date().toLocaleDateString()}

function reconcileData() {
  console.log('🚀 Reconciliation script starting...');
  
  // Your custom logic here
  
  console.log('✅ Reconciliation complete');
}

// Auto-execute
reconcileData();`;he({...F,scriptContent:t})},className:"text-xs px-2 py-1 text-blue-600 border border-blue-300 rounded hover:bg-blue-50",children:"Insert Template"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Deployment Info"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Client:"})," ",Q.businessName||Q.email]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Site URL:"})," ",ee[Q.id]||"No site provisioned"]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Client ID:"})," ",Q.businessName?.toLowerCase().replace(/[^a-z0-9]/g,"")||Q.id]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{it(!1),lt(null),G||he({scriptName:"",scriptContent:""})},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),is(Q)},disabled:$t[Q.id]||!F.scriptName||!F.scriptContent,className:`px-4 py-2 rounded-md transition-colors font-medium ${F.scriptContent&&G?"bg-green-600 text-white hover:bg-green-700":"bg-blue-600 text-white hover:bg-blue-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:$t[Q.id]?"Deploying...":F.scriptContent&&G?"🚀 Deploy Generated Script":"Deploy Script"})]})]})]})}),Us&&He&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4",children:["Edit User: ",He.email]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name"}),e.jsx("input",{type:"text",value:z.businessName,onChange:t=>Se({...z,businessName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter business name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Type"}),e.jsxs("select",{value:z.businessType,onChange:t=>Se({...z,businessType:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select business type"}),e.jsx("option",{value:"restaurant",children:"Restaurant"}),e.jsx("option",{value:"retail",children:"Retail Store"}),e.jsx("option",{value:"franchise",children:"Franchise"}),e.jsx("option",{value:"grocery",children:"Grocery Store"}),e.jsx("option",{value:"salon",children:"Salon/Spa"}),e.jsx("option",{value:"automotive",children:"Automotive"}),e.jsx("option",{value:"healthcare",children:"Healthcare/Medical"}),e.jsx("option",{value:"fitness",children:"Fitness/Gym"}),e.jsx("option",{value:"service",children:"Service Business"}),e.jsx("option",{value:"ecommerce",children:"E-commerce"}),e.jsx("option",{value:"hospitality",children:"Hotel/Hospitality"}),e.jsx("option",{value:"entertainment",children:"Entertainment/Events"}),e.jsx("option",{value:"professional",children:"Professional Services"}),e.jsx("option",{value:"nonprofit",children:"Non-Profit"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subscription Tier"}),e.jsxs("select",{value:z.subscriptionTier,onChange:t=>Se({...z,subscriptionTier:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"starter",children:["Starter - ",ue.starter," comparisons/month"]}),e.jsxs("option",{value:"professional",children:["Professional - ",ue.professional," comparisons/month"]}),e.jsxs("option",{value:"business",children:["Business - ",ue.business," comparisons/month"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Cycle"}),e.jsxs("select",{value:z.billingCycle,onChange:t=>Se({...z,billingCycle:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"annual",children:"Annual (Save 20%)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Notes (Private)"}),e.jsx("textarea",{value:z.adminNotes,onChange:t=>Se({...z,adminNotes:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"Add private notes about this client (special requirements, conversation history, etc.)"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{ot(!1),ct(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:ar,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Changes"})]})]})}),Fs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Select Client for Script Deployment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Choose which client gets the generated script:"}),e.jsxs("select",{id:"client-selection-dropdown",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a client..."}),_t.map(t=>e.jsxs("option",{value:t.id,children:[t.businessName||t.email," (",t.email,")"]},t.id))]})]}),G&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-md",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Script:"})," ",G.description.substring(0,50),"..."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Algorithm:"})," ",G.algorithm]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{Vt(!1),Ht([])},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:()=>{const s=document.getElementById("client-selection-dropdown")?.value;if(!s){B("warning","No Client Selected","Please select a client to deploy the script to.");return}const r=_t.find(i=>i.id===s);r&&(lt(r),it(!0),Vt(!1),Ht([]),B("info","Ready to Deploy",`Script pre-loaded for ${r.businessName||r.email}. Review and deploy!`))},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Deploy to Selected Client"})]})]})}),e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:Is.map(t=>e.jsx("div",{className:`max-w-sm p-4 rounded-lg shadow-lg border transition-all duration-300 ${t.type==="success"?"bg-green-50 border-green-200 text-green-800":t.type==="error"?"bg-red-50 border-red-200 text-red-800":t.type==="warning"?"bg-yellow-50 border-yellow-200 text-yellow-800":"bg-blue-50 border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex-shrink-0 mr-2 ${t.type==="success"?"text-green-400":t.type==="error"?"text-red-400":t.type==="warning"?"text-yellow-400":"text-blue-400"}`,children:[t.type==="success"&&e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),t.type==="error"&&e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),t.type==="warning"&&e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.type==="info"&&e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})]}),e.jsx("h4",{className:"text-sm font-medium",children:t.title})]}),e.jsx("p",{className:"mt-1 text-sm",children:t.message})]}),e.jsx("button",{onClick:()=>Vs(t.id),className:"ml-4 text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})},t.id))})]})})};var rn=Vr;export{rn as default};
